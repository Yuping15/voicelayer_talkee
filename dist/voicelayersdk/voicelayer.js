/*
VoiceLayer JS SDK
(c) 2013-2015 Yiip Inc. All rights reserved.
*/
/*!
 * Pusher JavaScript Library v2.2.4
 * http://pusher.com/
 *
 * Copyright 2014, Pusher
 * Released under the MIT licence.
 */
!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var voicelayer=require("./build/voicelayer"),Pusher=require("./vendor/pusher"),Base64=require("./vendor/Base64"),CryptoJS=require("./vendor/CryptoJS"),VoiceLayer=voicelayer["default"];window.VoiceLayer=VoiceLayer,VoiceLayer.setPusher(Pusher),VoiceLayer.setCrypto(CryptoJS),VoiceLayer.setBase64(Base64)},{"./build/voicelayer":20,"./vendor/Base64":26,"./vendor/CryptoJS":27,"./vendor/pusher":28}],2:[function(require,module,exports){var App=function(){function App(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return App.prototype.getInfo=function(callback){this.voiceLayerRest.getAppInfo(callback)},App.prototype.getUsers=function(callback,page){this.voiceLayerRest.getUsers(callback,page)},App}();exports["default"]=App},{}],3:[function(require,module,exports){var Attachments=function(){function Attachments(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return Attachments.prototype.getUrl=function(id){return this.voiceLayerRest.getAttachmentUrl(id)},Attachments}();exports["default"]=Attachments},{}],4:[function(require,module,exports){var Auth=function(){function Auth(voiceLayerRest,config,onLogin,onLogout){this.voiceLayerRest=voiceLayerRest,this.config=config,this.onLogin=onLogin,this.onLogout=onLogout}return Auth.prototype.setToken=function(token){this.config.userToken=token},Auth.prototype.register=function(params,callback){this.voiceLayerRest.register(params,callback)},Auth.prototype.login=function(email,password,callback){var connectAndCallback=function(err,result){err||(this.setToken(result.token),this.onLogin()),callback(err,result)}.bind(this);this.voiceLayerRest.login(email,password,connectAndCallback)},Auth.prototype.logout=function(callback){var disconnectAndCallback=function(err,result){this.setToken(null),this.onLogout(),callback(null,result)}.bind(this);this.voiceLayerRest.logout(disconnectAndCallback)},Auth.prototype.resetPassword=function(email,callback){this.voiceLayerRest.resetPassword(email,callback)},Auth.prototype.resendConfirmation=function(email,callback){this.voiceLayerRest.resendConfirmationInstructions(email,callback)},Auth}();exports["default"]=Auth},{}],5:[function(require,module,exports){function toUTF8Array(str){for(var utf8=[],i=0;i<str.length;i++){var charcode=str.charCodeAt(i);128>charcode?utf8.push(charcode):2048>charcode?utf8.push(192|charcode>>6,128|63&charcode):55296>charcode||charcode>=57344?utf8.push(224|charcode>>12,128|charcode>>6&63,128|63&charcode):(i++,charcode=65536+((1023&charcode)<<10|1023&str.charCodeAt(i)),utf8.push(240|charcode>>18,128|charcode>>12&63,128|charcode>>6&63,128|63&charcode))}return utf8}var util_1=require("./util"),Channels=function(){function Channels(voiceLayerRest,recorder){this.voiceLayerRest=voiceLayerRest,this.recorder=recorder}return Channels.prototype.create=function(params,callback){this.voiceLayerRest.createChannel(params,callback)},Channels.prototype.createDirect=function(user,callback){this.voiceLayerRest.createDirectChannel(user,callback)},Channels.prototype.get=function(channel,callback){this.voiceLayerRest.getChannel(channel,callback)},Channels.prototype.getPublic=function(callback,page){this.voiceLayerRest.getPublicChannels(callback,page)},Channels.prototype.getAttachments=function(channel,callback,page){this.voiceLayerRest.getAttachments(channel,callback,page)},Channels.prototype.getMessages=function(channel,callback,page){this.voiceLayerRest.getChannelMessages(channel,{},"",callback,page)},Channels.prototype.getRequests=function(channel,callback,page){this.voiceLayerRest.getChannelRequests(channel,callback,page)},Channels.prototype.getUsers=function(channel,callback,page){this.voiceLayerRest.getChannelUsers(channel,callback,page)},Channels.prototype.getInvitedUsers=function(channel,callback,page){this.voiceLayerRest.getInvitedUsers(channel,callback,page)},Channels.prototype.leave=function(channelId,callback){this.voiceLayerRest.deleteChannelUser(channelId,"me",callback)},Channels.prototype.subscribe=function(channelId,callback){this.voiceLayerRest.channelSubscribe(channelId,callback)},Channels.prototype.unsubscribe=function(channelId,callback){this.voiceLayerRest.channelUnsubscribe(channelId,callback)},Channels.prototype.createAttachment=function(channel,file,callback){this.voiceLayerRest.postAttachment(channel,file,callback)},Channels.prototype.createMessage=function(channel,message,callback){var messageId=util_1["default"].guid();this.voiceLayerRest.postRequest("text",messageId,channel,message,"",callback)},Channels.prototype.update=function(channel,params,callback){this.voiceLayerRest.updateChannel(channel,params,callback)},Channels.prototype.updateImage=function(channel,file,callback){this.voiceLayerRest.updateChannelImage(channel,file,callback)},Channels.prototype.updateUserPermissions=function(channel,user,permissions,callback){this.voiceLayerRest.updateChannelUserPermissions(channel,user,permissions,callback)},Channels.prototype["delete"]=function(channel,callback){this.voiceLayerRest.deleteChannel(channel,callback)},Channels.prototype.recordMessage=function(channel,message){message||(message={}),message.type="voice";var messageId=util_1["default"].guid(),mediaServer=this.voiceLayerRest.getMediaServer(),uploadPath=this.voiceLayerRest.getRecordPath(channel,messageId,mediaServer),payload=JSON.stringify(message),metadata=toUTF8Array("channel="+channel+"\n\n"+payload),metadataLength=metadata.length,arrayBuffer=new ArrayBuffer(metadataLength+8),view=new DataView(arrayBuffer);view.setUint8(0,255),view.setUint8(1,202),view.setUint8(2,254),view.setUint8(3,255),view.setUint16(4,metadataLength,!1),view.setUint16(6,0,!0);for(var i=0;metadataLength>i;i++)view.setUint8(i+8,metadata[i]);return this.recorder.start(uploadPath,[arrayBuffer]),messageId},Channels.prototype.requestAccess=function(channel,callback){this.voiceLayerRest.requestChannelAccess(channel,callback)},Channels}();exports["default"]=Channels},{"./util":19}],6:[function(require,module,exports){var Configuration=function(){function Configuration(){this.version="3.3.0",this.pubSubHost="apiv3.voicelayer.io",this.pubSubPort=443,this.pubSubIsSsl=!0,this.publishHost="apiv3.voicelayer.io",this.publishPort=443,this.publishIsSsl=!0,this.coordHost="cds.voicelayer.io",this.coordPort=80,this.mediaHost="apiv3.voicelayer.io",this.mediaPort=443,this.mediaIsSsl=!0,this.pingFrequency=12e4,this.pongTimeout=6e3,this.unavailableTimeout=1e4}return Configuration}();exports["default"]=Configuration},{}],7:[function(require,module,exports){var CurrentUser=function(){function CurrentUser(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return CurrentUser.prototype.getChannels=function(callback,page){this.voiceLayerRest.getChannels(callback,page)},CurrentUser.prototype.getRequests=function(callback,page){this.voiceLayerRest.getRequests(callback,page)},CurrentUser.prototype.getInvites=function(callback,page){this.voiceLayerRest.getInvites(callback,page)},CurrentUser.prototype.update=function(params,callback){this.voiceLayerRest.updateUser("me",params,callback)},CurrentUser.prototype.updateAvatar=function(file,callback){this.voiceLayerRest.updateAvatar(file,callback)},CurrentUser.prototype.deleteMeta=function(keys,callback){this.voiceLayerRest.deleteUserMeta("me",keys,callback)},CurrentUser}();exports["default"]=CurrentUser},{}],8:[function(require,module,exports){(function(Buffer){var Downloader=function(){function Downloader(){this.onEvent=null}return Downloader.prototype.startConnection=function(url){var _this=this;this.url=url,this.webSocket=new WebSocket(url),this.webSocket.onopen=function(event){_this.notifyEvent("started",null)},this.webSocket.onmessage=function(event){_this.processData(event.data)},this.webSocket.onclose=function(event){1==Math.floor(event.code/1e3)||event.wasClean?_this.notifyEvent("finished",null):_this.notifyEvent("failed",null),_this.endConnection()}},Downloader.prototype.endConnection=function(){this.webSocket&&(this.webSocket.close(),this.webSocket=null)},Downloader.prototype.processData=function(data){var _this=this,reader=new FileReader;reader.addEventListener("loadend",function(){var buffer=reader.result;_this.notifyEvent("buffer",buffer)}),"undefined"!=typeof Blob&&data instanceof Blob?reader.readAsArrayBuffer(data):"undefined"!=typeof Buffer&&data instanceof Buffer&&reader.readAsArrayBuffer(new File({name:"file.wav",buffer:data}))},Downloader.prototype.notifyEvent=function(event,data){null!=this.onEvent&&this.onEvent({event:event,data:data})},Downloader}();exports["default"]=Downloader}).call(this,require("buffer").Buffer)},{buffer:23}],9:[function(require,module,exports){var Invites=function(){function Invites(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return Invites.prototype.accept=function(channel,callback){this.voiceLayerRest.acceptInvite(channel,callback)},Invites.prototype.reject=function(channel,callback){this.voiceLayerRest.deleteChannelUser(channel,"me",callback)},Invites.prototype.create=function(channel,user,callback){this.voiceLayerRest.inviteUserToChannel(channel,[user],callback)},Invites}();exports["default"]=Invites},{}],10:[function(require,module,exports){var player_1=require("./player"),downloader_1=require("./downloader"),Player=function(){function Player(emitter,pathName){this.player=null,this.emitter=null,this.upsamplerWorker=null,this.decoderWorker=null,this.downloader=null,this.channelsCount=1,this.samplingRate=8e3,this.playerBufferSize=8192,this.playing=!1,this.emitter=emitter,this.pathName=pathName,this.initializePlayer()}return Player.prototype.start=function(downloadPath){this.downloader.startConnection(downloadPath),this.player.start()},Player.prototype.stop=function(){this.player.stop()},Player.prototype.isPlaying=function(){return this.player.isPlaying()},Player.prototype.initializePlayer=function(){var _this=this;this.upsamplerWorker=new Worker(this.pathName+"/rw.js"),this.decoderWorker=new Worker(this.pathName+"/dw.js"),this.player=new player_1["default"](this.samplingRate,1,16,!1,this.playerBufferSize),this.player.onEvent=function(e){_this.emitter.emit("player:"+e.event)},this.downloader=new downloader_1["default"],this.downloader.onEvent=function(e){switch(e.event){case"started":_this.emitter.emit("player:started");break;case"buffer":_this.decoderWorker.postMessage({command:"buffer",buffer:e.data});break;case"finished":_this.decoderWorker.postMessage({command:"finished"});break;case"failed":_this.player.stop(),_this.emitter.emit("player:failed","audio message not found")}},this.decoderWorker.onmessage=function(e){switch(e.data.command){case"init-resp":if("ok"!=e.data.status)throw"init decoder failed: "+e.data.status;break;case"buffer":if(!e.data.buffer)throw"decoder buffer was expected but is missing";_this.upsamplerWorker.postMessage({command:"buffer",buffer:new Float32Array(e.data.buffer)});break;case"finished":_this.upsamplerWorker.postMessage({command:"finished"})}},this.decoderWorker.postMessage({command:"init",config:{channels:this.channelsCount,sampling_rate:this.samplingRate}}),this.upsamplerWorker.onmessage=function(e){switch(e.data.command){case"init-resp":if("ok"!=e.data.status)throw"init upsampler failed: "+e.data.status;break;case"buffer":if(!e.data.buffer)throw"player resampler buffer was expected but is missing";_this.player.sendBuffers([new Float32Array(e.data.buffer)]);break;case"finished":_this.player.finished()}},this.upsamplerWorker.postMessage({command:"init",config:{input_sample_rate:this.samplingRate,input_float:!1,output_sample_rate:this.player.getSamplingRate(),output_float:!0,bits_per_sample:16}})},Player}();exports["default"]=Player},{"./downloader":8,"./player":13}],11:[function(require,module,exports){var recorder_1=require("./recorder"),uploader_1=require("./uploader"),Recorder=function(){function Recorder(emitter,pathName){this.recorder=null,this.emitter=null,this.downsamplerWorker=null,this.encoderWorker=null,this.uploader=null,this.recorderBuffers=[],this.recordByteLength=0,this.channelsCount=1,this.samplingRate=8e3,this.recorderBufferSize=4096,this.encodedBuffers=[],this.encodingByteLength=0,this.emitter=emitter,this.pathName=pathName,this.initializeRecorder()}return Recorder.prototype.start=function(uploadPath,metadata){return this.isMicEnabled()?(this.recorderBuffers=[],this.recordByteLength=0,this.encodedBuffers=[],this.encodingByteLength=0,this.recorder.start(),void this.uploader.startConnection(uploadPath,metadata)):void this.emitter.emit("recorder:failed","mic is disabled")},Recorder.prototype.isMicEnabled=function(){return this.recorder.isMicEnabled()},Recorder.prototype.requestMicAccess=function(callback){this.recorder.requestMicAccess(callback)},Recorder.prototype.stop=function(){this.recorder.stop(),this.uploader.endConnection(),this.emitter.emit("recorder:finished")},Recorder.prototype.isRecording=function(){return this.recorder.isRecording()},Recorder.prototype.getDuration=function(callback){if(callback){var duration=this.recorder.getDuration();callback(null,duration)}},Recorder.prototype.exportWav=function(){var type="audio/wav",fullBuffer=this.mergeArrayBuffers(this.recorderBuffers,this.recordByteLength),dataview=this.encodeWAV(new Uint16Array(fullBuffer)),audioBlob=new Blob([dataview],{type:type});return audioBlob},Recorder.prototype.exportSilk=function(){var type="audio/wav",fullBuffer=this.mergeArrayBuffers(this.encodedBuffers,this.encodingByteLength),audioBlob=new Blob([fullBuffer],{type:type});return audioBlob},Recorder.prototype.mergeArrayBuffers=function(buffers,totalLength){for(var result=new Uint8Array(totalLength),offset=0,i=0;i<buffers.length;i++)result.set(new Uint8Array(buffers[i]),offset),offset+=buffers[i].byteLength;return result.buffer},Recorder.prototype.initializeRecorder=function(){var _this=this;this.downsamplerWorker=new Worker(this.pathName+"/sw.js"),this.encoderWorker=new Worker(this.pathName+"/ew.js"),this.uploader=new uploader_1["default"],this.recorder=new recorder_1["default"](this.recorderBufferSize),this.downsamplerWorker.onmessage=function(e){switch(e.data.command){case"init-resp":if("ok"!=e.data.status)throw"init downsampler failed: "+e.data.status;_this.recorder.onEvent=function(e){switch(e.event){case"started":_this.emitter.emit("recorder:started");break;case"finished":break;case"failed":_this.emitter.emit("recorder:failed",e.data);break;case"buffer":_this.downsamplerWorker.postMessage({command:"buffer",buffer:e.buffer})}};break;case"buffer":if(!e.data.buffer)throw"resampler buffer was expected but is missing";_this.recorderBuffers.push(e.data.buffer),_this.recordByteLength+=e.data.buffer.byteLength,_this.encoderWorker.postMessage({command:"buffer",buffer:e.data.buffer})}},this.encoderWorker.onmessage=function(e){switch(e.data.command){case"init-resp":if("ok"!=e.data.status)throw"init encoder failed: "+e.data.status;break;case"buffers":if(!e.data.buffers)throw"encoder buffer was expected but is missing";for(var buffers=e.data.buffers,i=0;i<buffers.length;++i)_this.encodedBuffers.push(buffers[i]),_this.encodingByteLength+=buffers[i].byteLength,_this.uploader.sendData(buffers[i])}},this.downsamplerWorker.postMessage({command:"init",config:{channels:this.channelsCount,in_sampling_rate:this.recorder.getSamplingRate()}}),this.encoderWorker.postMessage({command:"init",config:{channels:this.channelsCount,sampling_rate:this.samplingRate}})},Recorder.prototype.encodeWAV=function(samples){var buffer=new ArrayBuffer(44+2*samples.length),view=new DataView(buffer);return this.writeString(view,0,"RIFF"),view.setUint32(4,36+2*samples.length,!0),this.writeString(view,8,"WAVE"),this.writeString(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,this.channelsCount,!0),view.setUint32(24,this.samplingRate,!0),view.setUint32(28,4*this.samplingRate,!0),view.setUint16(32,2*this.channelsCount,!0),view.setUint16(34,16,!0),this.writeString(view,36,"data"),view.setUint32(40,2*samples.length,!0),new Uint16Array(buffer,44,samples.length).set(samples),view},Recorder.prototype.writeString=function(view,offset,str){for(var i=0;i<str.length;i++)view.setUint8(offset+i,str.charCodeAt(i))},Recorder}();exports["default"]=Recorder},{"./recorder":14,"./uploader":17}],12:[function(require,module,exports){var Messages=function(){function Messages(voiceLayerRest,player,emitter){this.voiceLayerRest=voiceLayerRest,this.player=player,this.emitter=emitter}return Messages.prototype.get=function(id,callback){this.voiceLayerRest.getMessage(id,"",callback)},Messages.prototype.getMissed=function(since){var _this=this;this.voiceLayerRest.getMissedMessages(since,"",function(error,data){!error&&data.length>0&&_this.emitter.emit("message:missed",data)})},Messages.prototype.update=function(id,message,callback){this.voiceLayerRest.updateMessage(id,message,"",callback)},Messages.prototype["delete"]=function(id,callback){this.voiceLayerRest.deleteMessage(id,"",callback)},Messages.prototype.deleteMeta=function(id,keys,callback){this.voiceLayerRest.deleteMessageMeta(id,keys,callback)},Messages.prototype.play=function(id){var mediaServer=this.voiceLayerRest.getMediaServer(),uriPath=this.voiceLayerRest.getPlayPath(id,mediaServer);this.player.start(uriPath)},Messages}();exports["default"]=Messages},{}],13:[function(require,module,exports){var Player=function(){function Player(sampling_rate,channels,bits_per_sample,is_float,buffer_size){this.stop_request=!1,this.queue=[],this.queue_samples=0,this.queue_offset=0,this.onEvent=null,this.sampling_rate=sampling_rate,this.channels=channels,this.bits_per_sample=bits_per_sample,this.buffer_size=buffer_size,this.queue_threshold=2*buffer_size,this.initCtx()}return Player.prototype.initCtx=function(){var _this=this;this.ctx||(this.ctx=new AudioContext),this.node||(this.node=this.ctx.createScriptProcessor(this.buffer_size,0,this.channels),this.node.onaudioprocess=function(ev){_this.onaudioprocess(ev)})},Player.prototype.releaseCtx=function(){this.ctx&&this.node&&(this.node.disconnect(),this.node=null)},Player.prototype.onaudioprocess=function(ev){if(0==this.queue.length){for(var ch=0;ch<ev.outputBuffer.numberOfChannels;++ch)for(var buffer=ev.outputBuffer.getChannelData(ch),i=0;i<buffer.length;i++)buffer[i]=0;return void(this.stop_request&&(this._stop(),this.notifyFinished()))}for(var output=[],ch=0;ch<ev.outputBuffer.numberOfChannels;++ch)output.push(ev.outputBuffer.getChannelData(ch));for(var total_samples=output[0].length,copied=0;total_samples>copied&&this.queue.length>0;){for(var copy_samples=Math.min(this.queue[0][0].length-this.queue_offset,total_samples-copied),ch=0;ch<output.length;++ch)output[ch].set(this.queue[0][ch].subarray(this.queue_offset,this.queue_offset+copy_samples),copied);copied+=copy_samples,this.queue_offset+=copy_samples,this.queue_samples-=copy_samples,this.queue[0][0].length==this.queue_offset&&(this.queue_offset=0,this.queue.shift())}if(total_samples>copied)for(var ch=0;ch<output.length;++ch)for(var i=copied;i<output[ch].length;i++)output[ch][i]=0},Player.prototype.sendBuffers=function(buffers){this.queue_samples+=buffers[0].length,this.queue.push(buffers)},Player.prototype.reset=function(){this.queue=[],this.queue_offset=0},Player.prototype.start=function(){this.playing=!0,this.stop_request=!1,this.reset(),this.initCtx(),this.node&&this.node.connect(this.ctx.destination)},Player.prototype._stop=function(){this.releaseCtx(),this.reset()},Player.prototype.stop=function(){this._stop()},Player.prototype.isPlaying=function(){return!!this.playing},Player.prototype.finished=function(){this.node?this.stop_request=!0:this.notifyFinished()},Player.prototype.notifyFinished=function(){this.playing=!1,this.onEvent&&this.onEvent({event:"finished",data:null})},Player.prototype.destroy=function(){this.stop(),this.ctx=null,this.node=null,this.queue=null},Player.prototype.getSamplingRate=function(){return this.ctx.sampleRate},Player}();exports["default"]=Player},{}],14:[function(require,module,exports){var Recorder=function(){function Recorder(buffer_size){this.micRequestCallback=null,this.onEvent=null,this.channels=1,this.node=null,this.buffer_size=buffer_size,AudioContext=AudioContext||webkitAudioContext,this.ctx=new AudioContext}return Recorder.prototype.requestMicAccess=function(callback){var _this=this;return this.micRequestCallback?(this.micRequestCallback("aborted"),void(this.micRequestCallback=callback)):(this.micRequestCallback=callback,void(this.isMicEnabled()?callback&&callback(null):(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia({audio:!0,video:!1},function(stream){_this.source=_this.ctx.createMediaStreamSource(stream),_this.node=_this.ctx.createScriptProcessor(_this.buffer_size,_this.channels,_this.channels),_this.node.onaudioprocess=function(ev){_this.onaudioprocess(ev)},_this.micRequestCallback&&_this.micRequestCallback(null)},function(e){callback&&callback("mic is not enabled")}))))},Recorder.prototype.getSamplingRate=function(){return this.ctx.sampleRate},Recorder.prototype.isRecording=function(){return!!this.recording},Recorder.prototype.onaudioprocess=function(ev){this.duration=this.duration+ev.inputBuffer.duration,null!=this.onEvent&&this.onEvent({event:"buffer",buffer:ev.inputBuffer.getChannelData(0)})},Recorder.prototype.start=function(){this.node?(this.source.connect(this.node),this.duration=0,this.node.connect(this.ctx.destination),this.recording=!0,this.onEvent&&this.onEvent({event:"started",data:null})):this.onEvent&&this.onEvent({event:"failed",data:"recording is disabled"})},Recorder.prototype.stop=function(){this.recording=!1,this.node&&(this.node.disconnect(),this.onEvent&&this.onEvent({event:"finished",data:null}))},Recorder.prototype.destroy=function(){this.stop(),this.ctx=null,this.node=null,this.source=null},Recorder.prototype.isMicEnabled=function(){return null!=this.node},Recorder.prototype.getOutputSamplingRate=function(){return this.ctx.sampleRate},Recorder.prototype.getDuration=function(){return this.duration},Recorder}();exports["default"]=Recorder},{}],15:[function(require,module,exports){var Requests=function(){function Requests(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return Requests.prototype.accept=function(channel,user,callback){this.voiceLayerRest.acceptChannelRequest(channel,user,callback)},Requests.prototype.reject=function(channel,user,callback){this.voiceLayerRest.deleteChannelUser(channel,user,callback)},Requests.prototype.cancel=function(channel,callback){this.voiceLayerRest.deleteChannelUser(channel,"me",callback)},Requests}();exports["default"]=Requests},{}],16:[function(require,module,exports){var TimestampTracker=function(){function TimestampTracker(emitter){var _this=this;this.lastTimestamp=0,emitter.bind("message:create",function(data){_this.filterTimestamp(data)}),emitter.bind("recorder:started",function(){_this.updateLastTimestamp((new Date).getTime())})}return TimestampTracker.prototype.timestampCallback=function(callback){var _this=this;return function(error,data){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];error||_this.filterTimestamp(data),callback.apply(void 0,[error,data].concat(args))}},TimestampTracker.prototype.setLastTimestamp=function(lastTimestamp){this.lastTimestamp=lastTimestamp},TimestampTracker.prototype.getLastTimestamp=function(){var date=new Date;return this.lastTimestamp>0&&(date=new Date(this.lastTimestamp)),date.toISOString()},TimestampTracker.prototype.filterTimestamp=function(data){var timestamp;timestamp=Array.isArray(data)?Math.max.apply(Math,data.map(function(message){return new Date(message.created_at)})):new Date(data.created_at).getTime(),this.updateLastTimestamp(timestamp)},TimestampTracker.prototype.updateLastTimestamp=function(lastTimestamp){lastTimestamp+=1,lastTimestamp>this.lastTimestamp&&(this.lastTimestamp=lastTimestamp)},TimestampTracker}();exports["default"]=TimestampTracker},{}],17:[function(require,module,exports){var Uploader=function(){function Uploader(){}return Uploader.prototype.startConnection=function(url,metadata){var _this=this;this.url=url,this.readyBuffer=metadata||[],this.isReady=!1,this.webSocket=new WebSocket(url),this.webSocket.onopen=function(event){_this.isReady=!0,_this.sendReadyBufferIfNotEmpty()},this.webSocket.onmessage=function(event){}},Uploader.prototype.endConnection=function(){this.webSocket&&(this.sendReadyBufferIfNotEmpty(),this.webSocket.close(),this.webSocket=null,this.isReady=!1)},Uploader.prototype.sendData=function(buffer){this.webSocket&&(this.isReady?(this.sendReadyBufferIfNotEmpty(),this.webSocket.send(buffer)):this.readyBuffer.push(buffer))},Uploader.prototype.sendReadyBufferIfNotEmpty=function(){if(this.readyBuffer){var buffs=this.readyBuffer;this.readyBuffer=null;for(var i=0;i<buffs.length;i++)this.webSocket.send(buffs[i])}},Uploader}();exports["default"]=Uploader},{}],18:[function(require,module,exports){var Users=function(){function Users(voiceLayerRest){this.voiceLayerRest=voiceLayerRest}return Users.prototype.get=function(user,callback){this.voiceLayerRest.getUser(user,callback)},Users}();exports["default"]=Users},{}],19:[function(require,module,exports){var Util=function(){function Util(){}return Util.guid=function(){var s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()},Util.md5=function(input){return Util.Crypto.MD5(input).toString(Util.Crypto.enc.Hex)},Util.getTimeStamp=function(){return Math.floor((new Date).getTime()/1e3)},Util.randBytes=function(){for(var jti="",i=0;4>i;i++)jti+=("00000000"+Math.floor(4294967295*Math.random()).toString(16)).slice(-8);return jti},Util.encodeJWT=function(config){var ts=Util.getTimeStamp(),jti=Util.randBytes(),signData={iss:config.key,iat:ts,jti:jti};return config.userToken&&(signData.sub=config.userToken),this.generateJWT(signData,config.secret)},Util.generateJWT=function(payload,key){if(!key)throw new Error("Requires a secret to be set in config");var algorithm="HS256",header={typ:"JWT",alg:algorithm},segments=[];return segments.push(Util.base64urlEscape(Util.Base64.encode(JSON.stringify(header)))),segments.push(Util.base64urlEscape(Util.Base64.encode(JSON.stringify(payload)))),segments.push(Util.sign(segments.join("."),key)),segments.join(".")},Util.sign=function(input,key){var wordsArr=Util.Crypto.HmacSHA256(input,key);return Util.base64urlEscape(Util.Crypto.enc.Base64.stringify(wordsArr))},Util.base64urlEscape=function(str){return str.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},Util}();exports["default"]=Util},{}],20:[function(require,module,exports){var util_1=require("./util"),configuration_1=require("./configuration"),voicelayerrest_1=require("./voicelayerrest"),message_recorder_1=require("./message_recorder"),message_player_1=require("./message_player"),channels_1=require("./channels"),messages_1=require("./messages"),invites_1=require("./invites"),requests_1=require("./requests"),auth_1=require("./auth"),attachments_1=require("./attachments"),app_1=require("./app"),current_user_1=require("./current_user"),users_1=require("./users"),timestamp_tracker_1=require("./timestamp_tracker"),VoiceLayer=function(){function VoiceLayer(key,secret,options){if(this.channels=null,this.users=null,this.invites=null,this.requests=null,this.messages=null,this.recorder=null,this.player=null,this.auth=null,this.attachments=null,this.app=null,this.currentUser=null,this.hasConnected=null,this.timestampTracker=null,this.fetchMissedMessages=!1,this.config=null,this.voiceLayerRest=null,this.emitter=null,this.pusher=null,this.pathName="",this.config=new configuration_1["default"],this.config.appName="VoiceLayerSDK",this.config.key=key,this.config.secret=secret,"string"==typeof options)console.warn("Passing a string for the directory is deprecated. Please use {directory: 'path/to/workers'} instead."),this.pathName=options;else if(void 0!==options){options.directory&&(this.pathName=options.directory);for(var _i=0,_a=["pingFrequency","pongTimeout","unavailableTimeout"];_i<_a.length;_i++){var option=_a[_i];options[option]&&(this.config[option]=options[option])}}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,this.emitter=new VoiceLayer.Dispatcher,this.emitter.bind||(this.emitter.bind=this.emitter.on),this.emitter.unbind||(this.emitter.unbind=this.emitter.removeListener),this.timestampTracker=new timestamp_tracker_1["default"](this.emitter),this.voiceLayerRest=new voicelayerrest_1["default"](this.config,this.timestampTracker),this.recorder=new message_recorder_1["default"](this.emitter,this.pathName),this.player=new message_player_1["default"](this.emitter,this.pathName),this.channels=new channels_1["default"](this.voiceLayerRest,this.recorder),this.users=new users_1["default"](this.voiceLayerRest),this.messages=new messages_1["default"](this.voiceLayerRest,this.player,this.emitter),this.invites=new invites_1["default"](this.voiceLayerRest),this.requests=new requests_1["default"](this.voiceLayerRest),this.auth=new auth_1["default"](this.voiceLayerRest,this.config,this.connect.bind(this),this.disconnect.bind(this)),this.attachments=new attachments_1["default"](this.voiceLayerRest),this.app=new app_1["default"](this.voiceLayerRest),this.currentUser=new current_user_1["default"](this.voiceLayerRest)}return VoiceLayer.setPusher=function(pusher){VoiceLayer.PusherClient=pusher,VoiceLayer.Dispatcher=pusher.EventsDispatcher},VoiceLayer.setCrypto=function(crypto){util_1["default"].Crypto=crypto},VoiceLayer.setBase64=function(base64){util_1["default"].Base64=base64},VoiceLayer.setDispatcher=function(dispatcher){VoiceLayer.Dispatcher=dispatcher},VoiceLayer.prototype.configure=function(pubSubHost,pubSubPort,pubSubIsSsl,publishHost,publishPort,publishIsSsl,mediaHost,mediaPort,mediaIsSsl){pubSubHost&&(this.config.pubSubHost=pubSubHost),this.config.pubSubPort=pubSubPort,this.config.pubSubIsSsl=pubSubIsSsl,publishHost&&(this.config.publishHost=publishHost),this.config.publishPort=publishPort,this.config.publishIsSsl=publishIsSsl,mediaHost&&(this.config.mediaHost=mediaHost),this.config.mediaPort=mediaPort,this.config.mediaIsSsl=mediaIsSsl},VoiceLayer.prototype.connect=function(){var _this=this,jwt=function(){return util_1["default"].encodeJWT(_this.config)};this.pusher=new VoiceLayer.PusherClient(jwt,{wsHost:this.config.pubSubHost,wsPort:this.config.pubSubPort,wssPort:this.config.pubSubPort,host:this.config.pubSubHost,encrypted:this.config.pubSubIsSsl===!0,disableStats:!0,activity_timeout:this.config.pingFrequency,pong_timeout:this.config.pongTimeout,unavailable_timeout:this.config.unavailableTimeout}),this.pusher.connection.bind("connected",function(data){_this.fetchMissedMessages&&_this.hasConnected&&(_this.messages.getMissed(_this.timestampTracker.getLastTimestamp()),_this.fetchMissedMessages=!1),_this.hasConnected=!0,_this.trigger("connection:connected",data)});for(var _i=0,_a=["connecting","connecting_in","disconnected","unavailable"];_i<_a.length;_i++){var event=_a[_i];!function(evt){_this.pusher.connection.bind(evt,function(data){_this.fetchMissedMessages=!0,_this.trigger("connection:"+evt,data)})}(event)}var self=this;this.pusher.bind_all(function(event,data){this.event?self.trigger(this.event,event):self.trigger(event,data)}),this.pusher.connection.bind("failed",function(){_this.trigger.bind(_this,"connection:failed"),_this.pusher.connection.connect()}),this.pusher.connection.connect()},VoiceLayer.prototype.disconnect=function(){this.pusher.connection.disconnect()},VoiceLayer.prototype.on=function(event,callback){this.emitter.bind(event,callback)},VoiceLayer.prototype.off=function(event,callback){
this.emitter.unbind(event,callback)},VoiceLayer.prototype.trigger=function(event,data){this.emitter.emit(event,data)},VoiceLayer.PusherClient=null,VoiceLayer.Dispatcher=null,VoiceLayer}();exports["default"]=VoiceLayer},{"./app":2,"./attachments":3,"./auth":4,"./channels":5,"./configuration":6,"./current_user":7,"./invites":9,"./message_player":10,"./message_recorder":11,"./messages":12,"./requests":15,"./timestamp_tracker":16,"./users":18,"./util":19,"./voicelayerrest":21}],21:[function(require,module,exports){var util_1=require("./util"),VoiceLayerRest=function(){function VoiceLayerRest(config,missedMessages){this.config=config,this.missedMessages=missedMessages}return VoiceLayerRest.prototype.assembleData=function(type,messageId,userData){var ts=util_1["default"].getTimeStamp(),pushText=null;userData.push_text&&(pushText=userData.push_text,delete userData.push_text);var data={type:type,message_id:messageId,ts:ts,data:userData};return pushText&&(data.push_text=pushText),data},VoiceLayerRest.prototype.generateSignature=function(){return util_1["default"].encodeJWT(this.config)},VoiceLayerRest.prototype.generateUrl=function(path){var scheme=this.config.publishIsSsl?"https://":"http://";return path="/v1"+path,scheme+this.config.publishHost+":"+this.config.publishPort+path},VoiceLayerRest.prototype.attachParams=function(url,object){var a=document.createElement("a");a.href=url;var entries=[];for(var key in object)entries.push(key+"="+object[key]);var entryString=entries.join("&"),queryString=a.search;return-1===queryString.indexOf("?")?url+"?"+entryString:url+"&"+entryString},VoiceLayerRest.prototype.convertPageSize=function(object){return void 0===object.pageSize?object:(object.page_size=object.pageSize,delete object.pageSize,object)},VoiceLayerRest.prototype.signedRequest=function(method,path,data,callback,pagination){var _this=this,request=new XMLHttpRequest,url=this.generateUrl(path);pagination&&(url=pagination.url?pagination.url:this.attachParams(url,this.convertPageSize(pagination))),request.open(method,url,!0),request.setRequestHeader("Authorization","Bearer "+this.generateSignature()),!data||data instanceof FormData||(request.setRequestHeader("Content-type","application/json"),data=JSON.stringify(data)),request.onreadystatechange=function(){if(4==request.readyState){var response=request.responseText;try{response=JSON.parse(request.responseText)}catch(e){}if(2==Math.floor(request.status/100)){var link=request.getResponseHeader("link");callback&&callback(null,response,_this.parsePaginationLinks(link))}else callback&&callback("error:"+request.status,response)}},request.send(data)},VoiceLayerRest.prototype.parsePaginationLinks=function(link){if(!link||""===link)return{};var refs=link.split(","),pages=refs.reduce(function(acc,ref){var matches=ref.match(/<(.+)>; rel=\"([^"]+)\"/),url=matches[1],key=matches[2],params=url.match(/page=(\d+)&page_size=(\d+)/);return params?acc[key]={url:url,page:parseInt(params[1],10),pageSize:parseInt(params[2],10)}:(params=url.match(/before=([0-9a-f\-]+)&page_size=(\d+)/),acc[key]={url:url,before:params[1],pageSize:parseInt(params[2],10)}),acc},{});return pages},VoiceLayerRest.prototype.postRequest=function(type,messageId,channel,message,socket,callback){var data=this.assembleData(type,messageId,message),path="/channels/"+channel+"/messages";callback=this.missedMessages.timestampCallback(callback),this.signedRequest("POST",path,data,callback)},VoiceLayerRest.prototype.getChannels=function(callback,page){this.signedRequest("GET","/channels",null,callback,page)},VoiceLayerRest.prototype.getPublicChannels=function(callback,page){this.signedRequest("GET","/channels/public",null,callback,page)},VoiceLayerRest.prototype.getChannel=function(channelId,callback){this.signedRequest("GET","/channels/"+channelId,null,callback)},VoiceLayerRest.prototype.getChannelMessages=function(channel,options,socket,callback,page){var path="/channels/"+channel+"/messages";this.signedRequest("GET",path,null,this.missedMessages.timestampCallback(callback),page)},VoiceLayerRest.prototype.getMessage=function(messageId,socket,callback){var path="/messages/"+messageId;this.signedRequest("GET",path,null,callback)},VoiceLayerRest.prototype.getMissedMessages=function(since,socket,callback){var path="/messages/missed?since="+since;this.signedRequest("GET",path,null,callback)},VoiceLayerRest.prototype.updateMessage=function(messageId,message,socket,callback){var path="/messages/"+messageId;this.signedRequest("PUT",path,message,callback)},VoiceLayerRest.prototype.deleteMessage=function(messageId,socket,callback){var path="/messages/"+messageId;this.signedRequest("DELETE",path,null,callback)},VoiceLayerRest.prototype.deleteMessageMeta=function(messageId,keys,callback){var path="/messages/"+messageId+"/meta";this.signedRequest("DELETE",path,keys,callback)},VoiceLayerRest.prototype.getMediaPath=function(method,url,mediaServer){var scheme=(util_1["default"].getTimeStamp(),this.config.mediaIsSsl?"wss:":"ws:");return"POST"==method?scheme+"//"+mediaServer+url+"?method=POST":scheme+"//"+mediaServer+url+"?method=GET"},VoiceLayerRest.prototype.getMediaServer=function(){return this.config.mediaHost+":"+this.config.mediaPort},VoiceLayerRest.prototype.getRecordPath=function(channel,messageId,mediaServer){var url="/ws/app/"+this.generateSignature()+"/channels/"+channel+"/assets/"+messageId;return this.getMediaPath("POST",url,mediaServer)},VoiceLayerRest.prototype.getPlayPath=function(messageId,mediaServer){var url="/ws/app/"+this.generateSignature()+"/assets/"+messageId;return this.getMediaPath("GET",url,mediaServer)},VoiceLayerRest.prototype.getAppInfo=function(callback){this.signedRequest("GET","/app",null,callback)},VoiceLayerRest.prototype.register=function(data,callback){this.signedRequest("POST","/users",data,callback)},VoiceLayerRest.prototype.login=function(username,password,callback){var path="/users/login",data={username:username,password:password};this.signedRequest("POST",path,data,callback)},VoiceLayerRest.prototype.logout=function(callback){var path="/users/logout";this.signedRequest("DELETE",path,null,callback)},VoiceLayerRest.prototype.resetPassword=function(email,callback){var data={email:email};this.signedRequest("POST","/users/reset",data,callback)},VoiceLayerRest.prototype.resendConfirmationInstructions=function(email,callback){var data={email:email};this.signedRequest("POST","/users/confirmation/resend",data,callback)},VoiceLayerRest.prototype.getRequests=function(callback,page){this.signedRequest("GET","/requests",null,callback,page)},VoiceLayerRest.prototype.getInvites=function(callback,page){this.signedRequest("GET","/invites",null,callback,page)},VoiceLayerRest.prototype.acceptInvite=function(channelId,callback){this.signedRequest("PUT","/channels/"+channelId+"/accept",null,callback)},VoiceLayerRest.prototype.getUsers=function(callback,page){this.signedRequest("GET","/users",null,callback,page)},VoiceLayerRest.prototype.getUser=function(userId,callback){this.signedRequest("GET","/users/"+userId,null,callback)},VoiceLayerRest.prototype.getChannelUsers=function(channelId,callback,page){this.signedRequest("GET","/channels/"+channelId+"/users",null,callback,page)},VoiceLayerRest.prototype.getChannelRequests=function(channelId,callback,page){this.signedRequest("GET","/channels/"+channelId+"/requests",null,callback,page)},VoiceLayerRest.prototype.acceptChannelRequest=function(channelId,userId,callback){this.signedRequest("PUT","/channels/"+channelId+"/requests/"+userId,null,callback)},VoiceLayerRest.prototype.getInvitedUsers=function(channelId,callback,page){this.signedRequest("GET","/channels/"+channelId+"/invites",null,callback,page)},VoiceLayerRest.prototype.deleteChannelUser=function(channelId,userId,callback){this.signedRequest("DELETE","/channels/"+channelId+"/users/"+userId,null,callback)},VoiceLayerRest.prototype.deleteChannel=function(channelId,callback){this.signedRequest("DELETE","/channels/"+channelId,null,callback)},VoiceLayerRest.prototype.createDirectChannel=function(userId,callback){this.signedRequest("POST","/channels/direct",{user_id:userId},callback)},VoiceLayerRest.prototype.createChannel=function(params,callback){this.signedRequest("POST","/channels",params,callback)},VoiceLayerRest.prototype.updateChannel=function(channelId,params,callback){this.signedRequest("PUT","/channels/"+channelId,params,callback)},VoiceLayerRest.prototype.updateChannelImage=function(channelId,file,callback){var formData=new FormData;formData.append("file",file),this.signedRequest("PUT","/channels/"+channelId+"/image",formData,callback)},VoiceLayerRest.prototype.updateUser=function(userId,params,callback){this.signedRequest("PUT","/users/"+userId,params,callback)},VoiceLayerRest.prototype.updateAvatar=function(file,callback){var formData=new FormData;formData.append("file",file),this.signedRequest("PUT","/users/me/avatar",formData,callback)},VoiceLayerRest.prototype.deleteUserMeta=function(userId,keys,callback){var path="/users/"+userId+"/meta";this.signedRequest("DELETE",path,keys,callback)},VoiceLayerRest.prototype.getAttachments=function(channelId,callback,page){this.signedRequest("GET","/channels/"+channelId+"/attachments",null,callback,page)},VoiceLayerRest.prototype.postAttachment=function(channelId,file,callback){var formData=new FormData;formData.append("file",file),callback=this.missedMessages.timestampCallback(callback),this.signedRequest("POST","/channels/"+channelId+"/attachments",formData,callback)},VoiceLayerRest.prototype.getAttachmentUrl=function(id){var token=util_1["default"].encodeJWT(this.config),url=this.generateUrl("/attachments/"+id);return url+"?token="+token},VoiceLayerRest.prototype.channelSubscribe=function(channelId,callback){var path="/channels/"+channelId+"/subscriptions";this.signedRequest("POST",path,null,callback)},VoiceLayerRest.prototype.channelUnsubscribe=function(channelId,callback){var path="/channels/"+channelId+"/subscriptions";this.signedRequest("DELETE",path,null,callback)},VoiceLayerRest.prototype.updateChannelUserPermissions=function(channelId,userId,permissions,callback){this.signedRequest("PUT","/channels/"+channelId+"/permissions/"+userId,permissions,callback)},VoiceLayerRest.prototype.requestChannelAccess=function(channelId,callback){this.signedRequest("POST","/channels/"+channelId+"/requests",null,callback)},VoiceLayerRest.prototype.inviteUserToChannel=function(channelId,userIds,callback){var data={users:userIds.map(function(id){return{id:id}})};this.signedRequest("POST","/channels/"+channelId+"/invites",data,callback)},VoiceLayerRest}();exports["default"]=VoiceLayerRest},{"./util":19}],22:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],23:[function(require,module,exports){(function(global){"use strict";function typedArraySupport(){function Bar(){}try{var arr=new Uint8Array(1);return arr.foo=function(){return 42},arr.constructor=Bar,42===arr.foo()&&arr.constructor===Bar&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(Buffer.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(object.buffer instanceof ArrayBuffer)return fromTypedArray(that,object);if(object instanceof ArrayBuffer)return fromArrayBuffer(that,object)}return object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array){return Buffer.TYPED_ARRAY_SUPPORT?(array.byteLength,that=Buffer._augment(new Uint8Array(array))):that=fromTypedArray(that,new Uint8Array(array)),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?(that=Buffer._augment(new Uint8Array(length)),that.__proto__=Buffer.prototype):(that.length=length,that._isBuffer=!0);var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;end>i;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(end>=i+bytesPerSequence){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:128>firstByte&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(55296>tempCodePoint||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&1114112>tempCodePoint&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(MAX_ARGUMENTS_LENGTH>=len)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;len>i;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(1114112>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT?(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array):(Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),
this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&targetStart>start&&end>targetStart)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;len>i;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":22,ieee754:24,isarray:25}],24:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],25:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],26:[function(require,module,exports){var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=Base64._utf8_encode(input);i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);return output},decode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output)},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext},_utf8_decode:function(utftext){for(var string="",i=0,c=c1=c2=0;i<utftext.length;)c=utftext.charCodeAt(i),128>c?(string+=String.fromCharCode(c),i++):c>191&&224>c?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}};module.exports=Base64},{}],27:[function(require,module,exports){var CryptoJS=CryptoJS||function(h,s){var f={},g=f.lib={},q=function(){},m=g.Base={extend:function(a){q.prototype=this;var c=new q;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},r=g.WordArray=m.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||k).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;if(a=a.sigBytes,this.clamp(),b%4)for(var e=0;a>e;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;a>e;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4),a.length=h.ceil(c/4)},clone:function(){var a=m.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],d=0;a>d;d+=4)c.push(4294967296*h.random()|0);return new r.init(c,a)}}),l=f.enc={},k=l.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;a>b;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16)),d.push((15&e).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;c>b;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-4*(b%8);return new r.init(d,c/2)}},n=l.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;a>b;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;c>b;b++)d[b>>>2]|=(255&a.charCodeAt(b))<<24-8*(b%4);return new r.init(d,c)}},j=l.Utf8={stringify:function(a){try{return decodeURIComponent(escape(n.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return n.parse(unescape(encodeURIComponent(a)))}},u=g.BufferedBlockAlgorithm=m.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((0|f)-this._minBufferSize,0);if(a=f*e,b=h.min(4*a,b),a){for(var g=0;a>g;g+=e)this._doProcessBlock(d,g);g=d.splice(0,a),c.sigBytes-=b}return new r.init(g,b)},clone:function(){var a=m.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});g.Hasher=u.extend({cfg:m.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return new a.init(d).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return new t.HMAC.init(a,d).finalize(c)}}});var t=f.algo={};return f}(Math);!function(h){for(var s=CryptoJS,f=s.lib,g=f.WordArray,q=f.Hasher,f=s.algo,m=[],r=[],l=function(a){return 4294967296*(a-(0|a))|0},k=2,n=0;64>n;){var j;a:{j=k;for(var u=h.sqrt(j),t=2;u>=t;t++)if(!(j%t)){j=!1;break a}j=!0}j&&(8>n&&(m[n]=l(h.pow(k,.5))),r[n]=l(h.pow(k,1/3)),n++),k++}var a=[],f=f.SHA256=q.extend({_doReset:function(){this._hash=new g.init(m.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],g=b[2],j=b[3],h=b[4],m=b[5],n=b[6],q=b[7],p=0;64>p;p++){if(16>p)a[p]=0|c[d+p];else{var k=a[p-15],l=a[p-2];a[p]=((k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3)+a[p-7]+((l<<15|l>>>17)^(l<<13|l>>>19)^l>>>10)+a[p-16]}k=q+((h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25))+(h&m^~h&n)+r[p]+a[p],l=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&g^f&g),q=n,n=m,m=h,h=j+k|0,j=g,g=f,f=e,e=k+l|0}b[0]=b[0]+e|0,b[1]=b[1]+f|0,b[2]=b[2]+g|0,b[3]=b[3]+j|0,b[4]=b[4]+h|0,b[5]=b[5]+m|0,b[6]=b[6]+n|0,b[7]=b[7]+q|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;return d[e>>>5]|=128<<24-e%32,d[(e+64>>>9<<4)+14]=h.floor(b/4294967296),d[(e+64>>>9<<4)+15]=b,a.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var a=q.clone.call(this);return a._hash=this._hash.clone(),a}});s.SHA256=q._createHelper(f),s.HmacSHA256=q._createHmacHelper(f)}(Math),function(){var h=CryptoJS,s=h.enc.Utf8;h.algo.HMAC=h.lib.Base.extend({init:function(f,g){f=this._hasher=new f.init,"string"==typeof g&&(g=s.parse(g));var h=f.blockSize,m=4*h;g.sigBytes>m&&(g=f.finalize(g)),g.clamp();for(var r=this._oKey=g.clone(),l=this._iKey=g.clone(),k=r.words,n=l.words,j=0;h>j;j++)k[j]^=1549556828,n[j]^=909522486;r.sigBytes=l.sigBytes=m,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var g=this._hasher;return f=g.finalize(f),g.reset(),g.finalize(this._oKey.clone().concat(f))}})}();var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;return b&&h.mixIn(b),h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[],this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;if(b=b.sigBytes,this.clamp(),j%4)for(var g=0;b>g;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;b>g;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);return this.sigBytes+=b,this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<32-8*(h%4),b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var h=[],a=0;b>a;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16)),g.push((15&k).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j+=2)g[j>>>3]|=parseInt(b.substr(j,2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j++)g[j>>>2]|=(255&b.charCodeAt(j))<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data")}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init,this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((0|m)-this._minBufferSize,0);if(b=m*k,j=s.min(4*b,j),b){for(var l=0;b>l;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b),a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){return b&&this._append(b),this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return new b.init(g).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return new k.HMAC.init(b,g).finalize(a)}}});var k=m.algo={};return m}(Math);!function(s){function p(a,k,b,h,l,j,m){return a=a+(k&b|~k&h)+l+m,(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){return a=a+(k&h|b&~h)+l+m,(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){return a=a+(k^b^h)+l+m,(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){return a=a+(b^(k|~h))+l+m,(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0,b[1]=b[1]+d|0,b[2]=b[2]+e|0,b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/4294967296);for(k[(h+64>>>9<<4)+15]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),k[(h+64>>>9<<4)+14]=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),a.sigBytes=4*(k.length+1),this._process(),a=this._hash,k=a.words,b=0;4>b;b++)h=k[b],k[b]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8);return a},clone:function(){var a=t.clone.call(this);return a._hash=this._hash.clone(),a}}),r.MD5=t._createHelper(q),r.HmacMD5=t._createHmacHelper(q)}(Math),!function(){var r=CryptoJS,a=r.lib,t=a.WordArray,i=r.enc;i.Base64={stringify:function(r){var a=r.words,t=r.sigBytes,i=this._map;r.clamp();for(var n=[],f=0;t>f;f+=3)for(var e=a[f>>>2]>>>24-f%4*8&255,c=a[f+1>>>2]>>>24-(f+1)%4*8&255,h=a[f+2>>>2]>>>24-(f+2)%4*8&255,o=e<<16|c<<8|h,s=0;4>s&&t>f+.75*s;s++)n.push(i.charAt(o>>>6*(3-s)&63));var v=i.charAt(64);if(v)for(;n.length%4;)n.push(v);return n.join("")},parse:function(r){var a=r.length,i=this._map,n=i.charAt(64);if(n){var f=r.indexOf(n);-1!=f&&(a=f)}for(var e=[],c=0,h=0;a>h;h++)if(h%4){var o=i.indexOf(r.charAt(h-1))<<h%4*2,s=i.indexOf(r.charAt(h))>>>6-h%4*2;e[c>>>2]|=(o|s)<<24-c%4*8,c++}return t.create(e,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),module.exports=CryptoJS},{}],28:[function(require,module,exports){function Pusher(app_key,options){checkAppKey(app_key),options=options||{};var self=this;this.key=app_key,this.config=Pusher.Util.extend(Pusher.getGlobalConfig(),options.cluster?Pusher.getClusterConfig(options.cluster):{},options),this.channels=new Pusher.Channels,this.global_emitter=new Pusher.EventsDispatcher,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new Pusher.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:Pusher.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:Pusher.Timeline.INFO,version:Pusher.VERSION}),this.config.disableStats||(this.timelineSender=new Pusher.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));var getStrategy=function(options){var config=Pusher.Util.extend({},self.config,options);return Pusher.StrategyBuilder.build(Pusher.getDefaultStrategy(config),config)};this.connection=new Pusher.ConnectionManager(this.key,Pusher.Util.extend({getStrategy:getStrategy,timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){self.subscribeAll(),self.timelineSender&&self.timelineSender.send(self.connection.isEncrypted())}),this.connection.bind("message",function(params){var internal=0===params.event.indexOf("pusher_internal:");if(params.channel){var channel=self.channel(params.channel);channel&&channel.handleEvent(params.event,params.data)}internal||self.global_emitter.emit(params.event,params.data)}),this.connection.bind("disconnected",function(){self.channels.disconnect()}),this.connection.bind("error",function(err){Pusher.warn("Error",err)}),Pusher.instances.push(this),this.timeline.info({instances:Pusher.instances.length}),Pusher.isReady&&self.connect()}function checkAppKey(key){null!==key&&void 0!==key||Pusher.warn("Warning","You must pass your app key when you instantiate Pusher.")}function clearTimeout(timer){window.clearTimeout(timer)}function clearInterval(timer){window.clearInterval(timer)}function GenericTimer(set,clear,delay,callback){var self=this;this.clear=clear,this.timer=set(function(){null!==self.timer&&(self.timer=callback(self.timer))},delay)}function buildExceptionClass(name){var constructor=function(message){Error.call(this,message),this.name=name};return Pusher.Util.extend(constructor.prototype,Error.prototype),constructor}function EventsDispatcher(failThrough){this.callbacks=new CallbackRegistry,this.global_callbacks=[],this.failThrough=failThrough}function CallbackRegistry(){this._callbacks={}}function prefix(name){return"_"+name}function ScriptReceiverFactory(prefix,name){this.lastId=0,this.prefix=prefix,this.name=name}function ScriptRequest(src){this.src=src}function DependencyLoader(options){this.options=options,this.receivers=options.receivers||Pusher.ScriptReceivers,this.loading={}}function initialize(){Pusher.ready()}function onDocumentBody(callback){document.body?callback():setTimeout(function(){onDocumentBody(callback)},0)}function initializeOnDocumentBody(){onDocumentBody(initialize)}function JSONPRequest(url,data){this.url=url,this.data=data}function encodeParamsObject(data){return Pusher.Util.mapObject(data,function(value){return"object"==typeof value&&(value=JSON.stringify(value)),encodeURIComponent(Pusher.Base64.encode(value.toString()))})}function Timeline(key,session,options){this.key=key,this.session=session,this.events=[],this.options=options||{},this.sent=0,this.uniqueID=0}function TimelineSender(timeline,options){this.timeline=timeline,this.options=options||{}}function BestConnectedEverStrategy(strategies){this.strategies=strategies}function connect(strategies,minPriority,callbackBuilder){var runners=Pusher.Util.map(strategies,function(strategy,i,_,rs){return strategy.connect(minPriority,callbackBuilder(i,rs))});return{abort:function(){Pusher.Util.apply(runners,abortRunner)},forceMinPriority:function(p){Pusher.Util.apply(runners,function(runner){runner.forceMinPriority(p)})}}}function allRunnersFailed(runners){return Pusher.Util.all(runners,function(runner){return Boolean(runner.error)})}function abortRunner(runner){runner.error||runner.aborted||(runner.abort(),runner.aborted=!0)}function CachedStrategy(strategy,transports,options){this.strategy=strategy,this.transports=transports,this.ttl=options.ttl||18e5,this.encrypted=options.encrypted,this.timeline=options.timeline}function getTransportCacheKey(encrypted){return"pusherTransport"+(encrypted?"Encrypted":"Unencrypted")}function fetchTransportCache(encrypted){var storage=Pusher.Util.getLocalStorage();if(storage)try{var serializedCache=storage[getTransportCacheKey(encrypted)];if(serializedCache)return JSON.parse(serializedCache)}catch(e){flushTransportCache(encrypted)}return null}function storeTransportCache(encrypted,transport,latency){var storage=Pusher.Util.getLocalStorage();if(storage)try{storage[getTransportCacheKey(encrypted)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:transport,latency:latency})}catch(e){}}function flushTransportCache(encrypted){var storage=Pusher.Util.getLocalStorage();if(storage)try{delete storage[getTransportCacheKey(encrypted)]}catch(e){}}function DelayedStrategy(strategy,options){this.strategy=strategy,this.options={delay:options.delay}}function FirstConnectedStrategy(strategy){this.strategy=strategy}function IfStrategy(test,trueBranch,falseBranch){this.test=test,this.trueBranch=trueBranch,this.falseBranch=falseBranch}function SequentialStrategy(strategies,options){this.strategies=strategies,this.loop=Boolean(options.loop),this.failFast=Boolean(options.failFast),this.timeout=options.timeout,this.timeoutLimit=options.timeoutLimit}function TransportStrategy(name,priority,transport,options){this.name=name,this.priority=priority,this.transport=transport,this.options=options||{}}function failAttempt(error,callback){return Pusher.Util.defer(function(){callback(error)}),{abort:function(){},forceMinPriority:function(){}}}function getGenericURL(baseScheme,params,path){var scheme=baseScheme+(params.encrypted?"s":""),host=params.encrypted?params.hostEncrypted:params.hostUnencrypted;return scheme+"://"+host+path}function getGenericPath(key,queryString){var path="/app/"+key(),query="?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(queryString?"&"+queryString:"");return path+query}function TransportConnection(hooks,name,priority,key,options){Pusher.EventsDispatcher.call(this),this.hooks=hooks,this.name=name,this.priority=priority,this.key=key,this.options=options,this.state="new",this.timeline=options.timeline,this.activityTimeout=options.activityTimeout,this.id=this.timeline.generateUniqueID()}function Transport(hooks){this.hooks=hooks}function AssistantToTheTransportManager(manager,transport,options){this.manager=manager,this.transport=transport,this.minPingDelay=options.minPingDelay,this.maxPingDelay=options.maxPingDelay,this.pingDelay=void 0}function TransportManager(options){this.options=options||{},this.livesLeft=this.options.lives||1/0}function returnWithOriginalContext(f){return function(context){return[f.apply(this,arguments),context]}}function isSymbol(expression){return"string"==typeof expression&&":"===expression.charAt(0)}function getSymbolValue(expression,context){return context[expression.slice(1)]}function evaluateListOfExpressions(expressions,context){if(0===expressions.length)return[[],context];var head=evaluate(expressions[0],context),tail=evaluateListOfExpressions(expressions.slice(1),head[1]);return[[head[0]].concat(tail[0]),tail[1]]}function evaluateString(expression,context){
if(!isSymbol(expression))return[expression,context];var value=getSymbolValue(expression,context);if(void 0===value)throw"Undefined symbol "+expression;return[value,context]}function evaluateArray(expression,context){if(isSymbol(expression[0])){var f=getSymbolValue(expression[0],context);if(expression.length>1){if("function"!=typeof f)throw"Calling non-function "+expression[0];var args=[Pusher.Util.extend({},context)].concat(Pusher.Util.map(expression.slice(1),function(arg){return evaluate(arg,Pusher.Util.extend({},context))[0]}));return f.apply(this,args)}return[f,context]}return evaluateListOfExpressions(expression,context)}function evaluate(expression,context){return"string"==typeof expression?evaluateString(expression,context):"object"==typeof expression&&expression instanceof Array&&expression.length>0?evaluateArray(expression,context):[expression,context]}function Connection(id,transport){Pusher.EventsDispatcher.call(this),this.id=id,this.transport=transport,this.activityTimeout=transport.activityTimeout,this.bindListeners()}function Handshake(transport,callback){this.transport=transport,this.callback=callback,this.bindListeners()}function ConnectionManager(key,options){Pusher.EventsDispatcher.call(this),this.key=key,this.options=options||{},this.state="initialized",this.connection=null,this.encrypted=!!options.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var self=this;Pusher.Network.bind("online",function(){self.timeline.info({netinfo:"online"}),"connecting"!==self.state&&"unavailable"!==self.state||self.retryIn(0)}),Pusher.Network.bind("offline",function(){self.timeline.info({netinfo:"offline"}),self.connection&&self.sendActivityCheck()}),this.updateStrategy()}function NetInfo(){Pusher.EventsDispatcher.call(this);var self=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){self.emit("online")},!1),window.addEventListener("offline",function(){self.emit("offline")},!1))}function Members(){this.reset()}function Channel(name,pusher){Pusher.EventsDispatcher.call(this,function(event,data){Pusher.debug("No callbacks on "+name+" for "+event)}),this.name=name,this.pusher=pusher,this.subscribed=!1}function PrivateChannel(name,pusher){Pusher.Channel.call(this,name,pusher)}function PresenceChannel(name,pusher){Pusher.PrivateChannel.call(this,name,pusher),this.members=new Pusher.Members}function Channels(){this.channels={}}function createChannel(name,pusher){return 0===name.indexOf("private-")?new Pusher.PrivateChannel(name,pusher):0===name.indexOf("presence-")?new Pusher.PresenceChannel(name,pusher):new Pusher.Channel(name,pusher)}var prototype=Pusher.prototype;Pusher.instances=[],Pusher.isReady=!1,Pusher.debug=function(){Pusher.log&&Pusher.log(Pusher.Util.stringify.apply(this,arguments))},Pusher.warn=function(){var message=Pusher.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(message):window.console.log&&window.console.log(message)),Pusher.log&&Pusher.log(message)},Pusher.ready=function(){Pusher.isReady=!0;for(var i=0,l=Pusher.instances.length;l>i;i++)Pusher.instances[i].connect()},prototype.channel=function(name){return this.channels.find(name)},prototype.allChannels=function(){return this.channels.all()},prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var encrypted=this.connection.isEncrypted(),timelineSender=this.timelineSender;this.timelineSenderTimer=new Pusher.PeriodicTimer(6e4,function(){timelineSender.send(encrypted)})}},prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},prototype.bind=function(event_name,callback){return this.global_emitter.bind(event_name,callback),this},prototype.bind_all=function(callback){return this.global_emitter.bind_all(callback),this},prototype.subscribeAll=function(){var channelName;for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},prototype.subscribe=function(channel_name){var channel=this.channels.add(channel_name,this);return"connected"===this.connection.state&&channel.subscribe(),channel},prototype.unsubscribe=function(channel_name){var channel=this.channels.remove(channel_name);"connected"===this.connection.state&&channel.unsubscribe()},prototype.send_event=function(event_name,data,channel){return this.connection.send_event(event_name,data,channel)},prototype.isEncrypted=function(){return"https:"===Pusher.Util.getDocument().location.protocol?!0:Boolean(this.config.encrypted)},Pusher.HTTP={},this.Pusher=Pusher;var prototype=GenericTimer.prototype;prototype.isRunning=function(){return null!==this.timer},prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},Pusher.Timer=function(delay,callback){return new GenericTimer(setTimeout,clearTimeout,delay,function(timer){return callback(),null})},Pusher.PeriodicTimer=function(delay,callback){return new GenericTimer(setInterval,clearInterval,delay,function(timer){return callback(),timer})},Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(callback){return new Pusher.Timer(0,callback)},extend:function(target){for(var i=1;i<arguments.length;i++){var extensions=arguments[i];for(var property in extensions)extensions[property]&&extensions[property].constructor&&extensions[property].constructor===Object?target[property]=Pusher.Util.extend(target[property]||{},extensions[property]):target[property]=extensions[property]}return target},stringify:function(){for(var m=["Pusher"],i=0;i<arguments.length;i++)"string"==typeof arguments[i]?m.push(arguments[i]):void 0===window.JSON?m.push(arguments[i].toString()):m.push(JSON.stringify(arguments[i]));return m.join(" : ")},arrayIndexOf:function(array,item){var nativeIndexOf=Array.prototype.indexOf;if(null===array)return-1;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(var i=0,l=array.length;l>i;i++)if(array[i]===item)return i;return-1},objectApply:function(object,f){for(var key in object)Object.prototype.hasOwnProperty.call(object,key)&&f(object[key],key,object)},keys:function(object){var keys=[];return Pusher.Util.objectApply(object,function(_,key){keys.push(key)}),keys},values:function(object){var values=[];return Pusher.Util.objectApply(object,function(value){values.push(value)}),values},apply:function(array,f,context){for(var i=0;i<array.length;i++)f.call(context||window,array[i],i,array)},map:function(array,f){for(var result=[],i=0;i<array.length;i++)result.push(f(array[i],i,array,result));return result},mapObject:function(object,f){var result={};return Pusher.Util.objectApply(object,function(value,key){result[key]=f(value)}),result},filter:function(array,test){test=test||function(value){return!!value};for(var result=[],i=0;i<array.length;i++)test(array[i],i,array,result)&&result.push(array[i]);return result},filterObject:function(object,test){var result={};return Pusher.Util.objectApply(object,function(value,key){(test&&test(value,key,object,result)||Boolean(value))&&(result[key]=value)}),result},flatten:function(object){var result=[];return Pusher.Util.objectApply(object,function(value,key){result.push([key,value])}),result},any:function(array,test){for(var i=0;i<array.length;i++)if(test(array[i],i,array))return!0;return!1},all:function(array,test){for(var i=0;i<array.length;i++)if(!test(array[i],i,array))return!1;return!0},method:function(name){var boundArguments=Array.prototype.slice.call(arguments,1);return function(object){return object[name].apply(object,boundArguments.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(e){return}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(t){return t.isSupported({})}))},addWindowListener:function(event,listener){var _window=Pusher.Util.getWindow();void 0!==_window.addEventListener?_window.addEventListener(event,listener,!1):_window.attachEvent("on"+event,listener)},removeWindowListener:function(event,listener){var _window=Pusher.Util.getWindow();void 0!==_window.addEventListener?_window.removeEventListener(event,listener,!1):_window.detachEvent("on"+event,listener)},isXHRSupported:function(){var XHR=window.XMLHttpRequest;return Boolean(XHR)&&void 0!==(new XHR).withCredentials},isXDRSupported:function(encrypted){var protocol=encrypted?"https:":"http:",documentProtocol=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&documentProtocol===protocol}},Pusher.VERSION="2.2.4",Pusher.PROTOCOL=7,Pusher.host="pubsub.voicelayer.io",Pusher.ws_port=4e3,Pusher.wss_port=4e3,Pusher.sockjs_host="sockjs.pusher.com",Pusher.sockjs_http_port=80,Pusher.sockjs_https_port=443,Pusher.sockjs_path="/pusher",Pusher.stats_host="stats.pusher.com",Pusher.disableStats=!0,Pusher.channel_auth_endpoint="/pusher/auth",Pusher.channel_auth_transport="ajax",Pusher.activity_timeout=12e4,Pusher.pong_timeout=6e3,Pusher.unavailable_timeout=1e4,Pusher.cdn_http="",Pusher.cdn_https="",Pusher.dependency_suffix="",Pusher.getDefaultStrategy=function(config){var wsStrategy=[":best_connected_ever",":ws_loop",[":delayed",2e3,[":ws_fallback_loop"]]];return[[":def","ws_options",{hostUnencrypted:config.wsHost+":"+config.wsPort,hostEncrypted:config.wsHost+":"+config.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:config.httpHost+":"+config.httpPort,hostEncrypted:config.httpHost+":"+config.httpsPort,httpPath:config.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:config.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:config.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","ws_fallback_loop",[":sequential",":timeouts",[":if",[":is_supported",":ws"],":ws",":wss"]]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],wsStrategy,[":ws_fallback_loop"]]]]]]},Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}},Pusher.getClusterConfig=function(clusterName){return{wsHost:"ws-"+clusterName+".pusher.com",httpHost:"sockjs-"+clusterName+".pusher.com"}},Pusher.Errors={BadEventName:buildExceptionClass("BadEventName"),RequestTimedOut:buildExceptionClass("RequestTimedOut"),TransportPriorityTooLow:buildExceptionClass("TransportPriorityTooLow"),TransportClosed:buildExceptionClass("TransportClosed"),UnsupportedTransport:buildExceptionClass("UnsupportedTransport"),UnsupportedStrategy:buildExceptionClass("UnsupportedStrategy")};var prototype=EventsDispatcher.prototype;prototype.bind=function(eventName,callback,context){return this.callbacks.add(eventName,callback,context),this},prototype.bind_all=function(callback){return this.global_callbacks.push(callback),this},prototype.unbind=function(eventName,callback,context){return this.callbacks.remove(eventName,callback,context),this},prototype.unbind_all=function(eventName,callback){return this.callbacks.remove(eventName,callback),this},prototype.emit=function(eventName,data){var i;for(i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](eventName,data);var callbacks=this.callbacks.get(eventName);if(callbacks&&callbacks.length>0)for(i=0;i<callbacks.length;i++)callbacks[i].fn.call(callbacks[i].context||window,data);else this.failThrough&&this.failThrough(eventName,data);return this},CallbackRegistry.prototype.get=function(name){return this._callbacks[prefix(name)]},CallbackRegistry.prototype.add=function(name,callback,context){var prefixedEventName=prefix(name);this._callbacks[prefixedEventName]=this._callbacks[prefixedEventName]||[],this._callbacks[prefixedEventName].push({fn:callback,context:context})},CallbackRegistry.prototype.remove=function(name,callback,context){if(!name&&!callback&&!context)return void(this._callbacks={});var names=name?[prefix(name)]:Pusher.Util.keys(this._callbacks);callback||context?Pusher.Util.apply(names,function(name){this._callbacks[name]=Pusher.Util.filter(this._callbacks[name]||[],function(binding){return callback&&callback!==binding.fn||context&&context!==binding.context}),0===this._callbacks[name].length&&delete this._callbacks[name]},this):Pusher.Util.apply(names,function(name){delete this._callbacks[name]},this)},Pusher.EventsDispatcher=EventsDispatcher;var prototype=ScriptReceiverFactory.prototype;prototype.create=function(callback){this.lastId++;var number=this.lastId,id=this.prefix+number,name=this.name+"["+number+"]",called=!1,callbackWrapper=function(){called||(callback.apply(null,arguments),called=!0)};return this[number]=callbackWrapper,{number:number,id:id,name:name,callback:callbackWrapper}},prototype.remove=function(receiver){delete this[receiver.number]},Pusher.ScriptReceiverFactory=ScriptReceiverFactory,Pusher.ScriptReceivers=new ScriptReceiverFactory("_pusher_script_","Pusher.ScriptReceivers");var prototype=ScriptRequest.prototype;prototype.send=function(receiver){var self=this,errorString="Error loading "+self.src;self.script=document.createElement("script"),self.script.id=receiver.id,self.script.src=self.src,self.script.type="text/javascript",self.script.charset="UTF-8",self.script.addEventListener?(self.script.onerror=function(){receiver.callback(errorString)},self.script.onload=function(){receiver.callback(null)}):self.script.onreadystatechange=function(){"loaded"!==self.script.readyState&&"complete"!==self.script.readyState||receiver.callback(null)},void 0===self.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(self.errorScript=document.createElement("script"),self.errorScript.id=receiver.id+"_error",self.errorScript.text=receiver.name+"('"+errorString+"');",self.script.async=self.errorScript.async=!1):self.script.async=!0;var head=document.getElementsByTagName("head")[0];head.insertBefore(self.script,head.firstChild),self.errorScript&&head.insertBefore(self.errorScript,self.script.nextSibling)},prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},Pusher.ScriptRequest=ScriptRequest;var prototype=DependencyLoader.prototype;prototype.load=function(name,options,callback){var self=this;if(self.loading[name]&&self.loading[name].length>0)self.loading[name].push(callback);else{self.loading[name]=[callback];var request=new Pusher.ScriptRequest(self.getPath(name,options)),receiver=self.receivers.create(function(error){if(self.receivers.remove(receiver),self.loading[name]){var callbacks=self.loading[name];delete self.loading[name];for(var successCallback=function(wasSuccessful){wasSuccessful||request.cleanup()},i=0;i<callbacks.length;i++)callbacks[i](error,successCallback)}});request.send(receiver)}},prototype.getRoot=function(options){var cdn,protocol=Pusher.Util.getDocument().location.protocol;return cdn=options&&options.encrypted||"https:"===protocol?this.options.cdn_https:this.options.cdn_http,cdn.replace(/\/*$/,"")+"/"+this.options.version},prototype.getPath=function(name,options){return this.getRoot(options)+"/"+name+this.options.suffix+".js"},Pusher.DependencyLoader=DependencyLoader,Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers}),window.JSON?initializeOnDocumentBody():Pusher.Dependencies.load("json2",{},initializeOnDocumentBody);for(var Base64={encode:function(s){return btoa(utob(s))}},fromCharCode=String.fromCharCode,b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab={},i=0,l=b64chars.length;l>i;i++)b64tab[b64chars.charAt(i)]=i;var cb_utob=function(c){var cc=c.charCodeAt(0);return 128>cc?c:2048>cc?fromCharCode(192|cc>>>6)+fromCharCode(128|63&cc):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc)},utob=function(u){return u.replace(/[^\x00-\x7F]/g,cb_utob)},cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0),chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(63&ord)];return chars.join("")},btoa=window.btoa||function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};Pusher.Base64=Base64;var prototype=JSONPRequest.prototype;prototype.send=function(receiver){if(!this.request){var params=Pusher.Util.filterObject(this.data,function(value){return void 0!==value}),query=Pusher.Util.map(Pusher.Util.flatten(encodeParamsObject(params)),Pusher.Util.method("join","=")).join("&"),url=this.url+"/"+receiver.number+"?"+query;this.request=new Pusher.ScriptRequest(url),this.request.send(receiver)}},prototype.cleanup=function(){this.request&&this.request.cleanup()},Pusher.JSONPRequest=JSONPRequest;var prototype=Timeline.prototype;Timeline.ERROR=3,Timeline.INFO=6,Timeline.DEBUG=7,prototype.log=function(level,event){level<=this.options.level&&(this.events.push(Pusher.Util.extend({},event,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},prototype.error=function(event){this.log(Timeline.ERROR,event)},prototype.info=function(event){this.log(Timeline.INFO,event)},prototype.debug=function(event){this.log(Timeline.DEBUG,event)},prototype.isEmpty=function(){return 0===this.events.length},prototype.send=function(sendJSONP,callback){var self=this,data=Pusher.Util.extend({session:self.session,bundle:self.sent+1,key:self.key,lib:"js",version:self.options.version,cluster:self.options.cluster,features:self.options.features,timeline:self.events},self.options.params);return self.events=[],sendJSONP(data,function(error,result){error||self.sent++,callback&&callback(error,result)}),!0},prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},Pusher.Timeline=Timeline;var prototype=TimelineSender.prototype;prototype.send=function(encrypted,callback){var self=this;if(!self.timeline.isEmpty()){var sendJSONP=function(data,callback){var scheme="http"+(encrypted?"s":"")+"://",url=scheme+(self.host||self.options.host)+self.options.path,request=new Pusher.JSONPRequest(url,data),receiver=Pusher.ScriptReceivers.create(function(error,result){Pusher.ScriptReceivers.remove(receiver),request.cleanup(),result&&result.host&&(self.host=result.host),callback&&callback(error,result)});request.send(receiver)};self.timeline.send(sendJSONP,callback)}},Pusher.TimelineSender=TimelineSender;var prototype=BestConnectedEverStrategy.prototype;prototype.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},prototype.connect=function(minPriority,callback){return connect(this.strategies,minPriority,function(i,runners){return function(error,handshake){return runners[i].error=error,error?void(allRunnersFailed(runners)&&callback(!0)):(Pusher.Util.apply(runners,function(runner){runner.forceMinPriority(handshake.transport.priority)}),void callback(null,handshake))}})},Pusher.BestConnectedEverStrategy=BestConnectedEverStrategy;var prototype=CachedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var encrypted=this.encrypted,info=fetchTransportCache(encrypted),strategies=[this.strategy];if(info&&info.timestamp+this.ttl>=Pusher.Util.now()){var transport=this.transports[info.transport];transport&&(this.timeline.info({cached:!0,transport:info.transport,latency:info.latency}),strategies.push(new Pusher.SequentialStrategy([transport],{timeout:2*info.latency+1e3,failFast:!0})))}var startTimestamp=Pusher.Util.now(),runner=strategies.pop().connect(minPriority,function cb(error,handshake){error?(flushTransportCache(encrypted),strategies.length>0?(startTimestamp=Pusher.Util.now(),runner=strategies.pop().connect(minPriority,cb)):callback(error)):(storeTransportCache(encrypted,handshake.transport.name,Pusher.Util.now()-startTimestamp),callback(null,handshake))});return{abort:function(){runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},Pusher.CachedStrategy=CachedStrategy;var prototype=DelayedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var runner,strategy=this.strategy,timer=new Pusher.Timer(this.options.delay,function(){runner=strategy.connect(minPriority,callback)});return{abort:function(){timer.ensureAborted(),runner&&runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},Pusher.DelayedStrategy=DelayedStrategy;var prototype=FirstConnectedStrategy.prototype;prototype.isSupported=function(){return this.strategy.isSupported()},prototype.connect=function(minPriority,callback){var runner=this.strategy.connect(minPriority,function(error,handshake){handshake&&runner.abort(),callback(error,handshake)});return runner},Pusher.FirstConnectedStrategy=FirstConnectedStrategy;var prototype=IfStrategy.prototype;prototype.isSupported=function(){var branch=this.test()?this.trueBranch:this.falseBranch;return branch.isSupported()},prototype.connect=function(minPriority,callback){var branch=this.test()?this.trueBranch:this.falseBranch;return branch.connect(minPriority,callback)},Pusher.IfStrategy=IfStrategy;var prototype=SequentialStrategy.prototype;prototype.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},prototype.connect=function(minPriority,callback){var self=this,strategies=this.strategies,current=0,timeout=this.timeout,runner=null,tryNextStrategy=function(error,handshake){handshake?callback(null,handshake):(current+=1,self.loop&&(current%=strategies.length),current<strategies.length?(timeout&&(timeout=2*timeout,self.timeoutLimit&&(timeout=Math.min(timeout,self.timeoutLimit))),runner=self.tryStrategy(strategies[current],minPriority,{timeout:timeout,failFast:self.failFast},tryNextStrategy)):callback(!0))};return runner=this.tryStrategy(strategies[current],minPriority,{timeout:timeout,failFast:this.failFast},tryNextStrategy),{abort:function(){runner.abort()},forceMinPriority:function(p){minPriority=p,runner&&runner.forceMinPriority(p)}}},prototype.tryStrategy=function(strategy,minPriority,options,callback){var timer=null,runner=null;return options.timeout>0&&(timer=new Pusher.Timer(options.timeout,function(){runner.abort(),callback(!0)})),runner=strategy.connect(minPriority,function(error,handshake){error&&timer&&timer.isRunning()&&!options.failFast||(timer&&timer.ensureAborted(),callback(error,handshake))}),{abort:function(){timer&&timer.ensureAborted(),runner.abort()},forceMinPriority:function(p){runner.forceMinPriority(p)}}},Pusher.SequentialStrategy=SequentialStrategy;var prototype=TransportStrategy.prototype;prototype.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})},prototype.connect=function(minPriority,callback){if(!this.isSupported())return failAttempt(new Pusher.Errors.UnsupportedStrategy,callback);if(this.priority<minPriority)return failAttempt(new Pusher.Errors.TransportPriorityTooLow,callback);var self=this,connected=!1,transport=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),handshake=null,onInitialized=function(){transport.unbind("initialized",onInitialized),transport.connect()},onOpen=function(){handshake=new Pusher.Handshake(transport,function(result){connected=!0,unbindListeners(),callback(null,result)})},onError=function(error){unbindListeners(),callback(error)},onClosed=function(){unbindListeners(),callback(new Pusher.Errors.TransportClosed(transport))},unbindListeners=function(){transport.unbind("initialized",onInitialized),transport.unbind("open",onOpen),transport.unbind("error",onError),transport.unbind("closed",onClosed)};return transport.bind("initialized",onInitialized),transport.bind("open",onOpen),transport.bind("error",onError),transport.bind("closed",onClosed),transport.initialize(),{abort:function(){connected||(unbindListeners(),handshake?handshake.close():transport.close())},forceMinPriority:function(p){connected||self.priority<p&&(handshake?handshake.close():transport.close())}}},Pusher.TransportStrategy=TransportStrategy,Pusher.URLSchemes={ws:{getInitial:function(key,params){return getGenericURL("ws",params,getGenericPath(key,"flash=false"))}},flash:{getInitial:function(key,params){return getGenericURL("ws",params,getGenericPath(key,"flash=true"))}},sockjs:{getInitial:function(key,params){return getGenericURL("http",params,params.httpPath||"/pusher","")},getPath:function(key,params){return getGenericPath(key)}},http:{getInitial:function(key,params){var path=(params.httpPath||"/pusher")+getGenericPath(key);return getGenericURL("http",params,path)}}};var prototype=TransportConnection.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},prototype.supportsPing=function(){return Boolean(this.hooks.supportsPing)},prototype.initialize=function(){var self=this;self.timeline.info(self.buildTimelineMessage({transport:self.name+(self.options.encrypted?"s":"")})),self.hooks.beforeInitialize&&self.hooks.beforeInitialize.call(self),self.hooks.isInitialized()?self.changeState("initialized"):self.hooks.file?(self.changeState("initializing"),Pusher.Dependencies.load(self.hooks.file,{encrypted:self.options.encrypted},function(error,callback){self.hooks.isInitialized()?(self.changeState("initialized"),callback(!0)):(error&&self.onError(error),self.onClose(),callback(!1))})):self.onClose()},prototype.connect=function(){var self=this;if(self.socket||"initialized"!==self.state)return!1;var url=self.hooks.urls.getInitial(self.key,self.options);try{self.socket=self.hooks.getSocket(url,self.options)}catch(e){return Pusher.Util.defer(function(){self.onError(e),self.changeState("closed")}),!1}return self.bindListeners(),Pusher.debug("Connecting",{transport:self.name,url:url}),self.changeState("connecting"),!0},prototype.close=function(){return this.socket?(this.socket.close(),!0):!1},prototype.send=function(data){var self=this;return"open"===self.state?(Pusher.Util.defer(function(){self.socket&&self.socket.send(data)}),!0):!1},prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},prototype.onError=function(error){this.emit("error",{type:"WebSocketError",error:error}),this.timeline.error(this.buildTimelineMessage({error:error.toString()}))},prototype.onClose=function(closeEvent){closeEvent?this.changeState("closed",{code:closeEvent.code,reason:closeEvent.reason,wasClean:closeEvent.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},prototype.onMessage=function(message){this.emit("message",message)},prototype.onActivity=function(){this.emit("activity")},prototype.bindListeners=function(){var self=this;self.socket.onopen=function(){self.onOpen()},self.socket.onerror=function(error){self.onError(error)},self.socket.onclose=function(closeEvent){self.onClose(closeEvent)},self.socket.onmessage=function(message){self.onMessage(message)},self.supportsPing()&&(self.socket.onactivity=function(){self.onActivity()})},prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},prototype.changeState=function(state,params){this.state=state,this.timeline.info(this.buildTimelineMessage({state:state,params:params})),this.emit(state,params)},prototype.buildTimelineMessage=function(message){return Pusher.Util.extend({cid:this.id},message)},Pusher.TransportConnection=TransportConnection;var prototype=Transport.prototype;prototype.isSupported=function(environment){return this.hooks.isSupported(environment)},prototype.createConnection=function(name,priority,key,options){return new Pusher.TransportConnection(this.hooks,name,priority,key,options)},Pusher.Transport=Transport,Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(url){var Constructor=window.WebSocket||window.MozWebSocket;return new Constructor(url)}}),Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e1){try{var nav=Pusher.Util.getNavigator();return Boolean(nav&&nav.mimeTypes&&void 0!==nav.mimeTypes["application/x-shockwave-flash"])}catch(e2){return!1}}},beforeInitialize:function(){void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0),window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot({encrypted:this.options.encrypted})+"/WebSocketMain.swf"},isInitialized:function(){return void 0!==window.FlashWebSocket},getSocket:function(url){return new FlashWebSocket(url)}}),Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,
handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(url,options){return new SockJS(url,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:options.encrypted}),ignore_null_origin:options.ignoreNullOrigin})},beforeOpen:function(socket,path){socket.send(JSON.stringify({path:path}))}});var httpConfiguration={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},streamingConfiguration=Pusher.Util.extend({getSocket:function(url){return Pusher.HTTP.getStreamingSocket(url)}},httpConfiguration),pollingConfiguration=Pusher.Util.extend({getSocket:function(url){return Pusher.HTTP.getPollingSocket(url)}},httpConfiguration),xhrConfiguration={file:"xhr",isSupported:Pusher.Util.isXHRSupported},xdrConfiguration={file:"xdr",isSupported:function(environment){return Pusher.Util.isXDRSupported(environment.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},streamingConfiguration,xhrConfiguration)),Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},streamingConfiguration,xdrConfiguration)),Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},pollingConfiguration,xhrConfiguration)),Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},pollingConfiguration,xdrConfiguration));var prototype=AssistantToTheTransportManager.prototype;prototype.createConnection=function(name,priority,key,options){var self=this;options=Pusher.Util.extend({},options,{activityTimeout:self.pingDelay});var connection=self.transport.createConnection(name,priority,key,options),openTimestamp=null,onOpen=function(){connection.unbind("open",onOpen),connection.bind("closed",onClosed),openTimestamp=Pusher.Util.now()},onClosed=function(closeEvent){if(connection.unbind("closed",onClosed),1002===closeEvent.code||1003===closeEvent.code)self.manager.reportDeath();else if(!closeEvent.wasClean&&openTimestamp){var lifespan=Pusher.Util.now()-openTimestamp;lifespan<2*self.maxPingDelay&&(self.manager.reportDeath(),self.pingDelay=Math.max(lifespan/2,self.minPingDelay))}};return connection.bind("open",onOpen),connection},prototype.isSupported=function(environment){return this.manager.isAlive()&&this.transport.isSupported(environment)},Pusher.AssistantToTheTransportManager=AssistantToTheTransportManager;var prototype=TransportManager.prototype;prototype.getAssistant=function(transport){return new Pusher.AssistantToTheTransportManager(this,transport,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},prototype.isAlive=function(){return this.livesLeft>0},prototype.reportDeath=function(){this.livesLeft-=1},Pusher.TransportManager=TransportManager;var StrategyBuilder={build:function(scheme,options){var context=Pusher.Util.extend({},globalContext,options);return evaluate(scheme,context)[1].strategy}},transports={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},UnsupportedStrategy={isSupported:function(){return!1},connect:function(_,callback){var deferred=Pusher.Util.defer(function(){callback(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){deferred.ensureAborted()},forceMinPriority:function(){}}}},globalContext={extend:function(context,first,second){return[Pusher.Util.extend({},first,second),context]},def:function(context,name,value){if(void 0!==context[name])throw"Redefining symbol "+name;return context[name]=value,[void 0,context]},def_transport:function(context,name,type,priority,options,manager){var transportClass=transports[type];if(!transportClass)throw new Pusher.Errors.UnsupportedTransport(type);var transport,enabled=!(context.enabledTransports&&-1===Pusher.Util.arrayIndexOf(context.enabledTransports,name)||context.disabledTransports&&-1!==Pusher.Util.arrayIndexOf(context.disabledTransports,name)||"flash"===name&&context.disableFlash===!0);transport=enabled?new Pusher.TransportStrategy(name,priority,manager?manager.getAssistant(transportClass):transportClass,Pusher.Util.extend({key:context.key,encrypted:context.encrypted,timeline:context.timeline,ignoreNullOrigin:context.ignoreNullOrigin},options)):UnsupportedStrategy;var newContext=context.def(context,name,transport)[1];return newContext.transports=context.transports||{},newContext.transports[name]=transport,[void 0,newContext]},transport_manager:returnWithOriginalContext(function(_,options){return new Pusher.TransportManager(options)}),sequential:returnWithOriginalContext(function(_,options){var strategies=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(strategies,options)}),cached:returnWithOriginalContext(function(context,ttl,strategy){return new Pusher.CachedStrategy(strategy,context.transports,{ttl:ttl,timeline:context.timeline,encrypted:context.encrypted})}),first_connected:returnWithOriginalContext(function(_,strategy){return new Pusher.FirstConnectedStrategy(strategy)}),best_connected_ever:returnWithOriginalContext(function(){var strategies=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(strategies)}),delayed:returnWithOriginalContext(function(_,delay,strategy){return new Pusher.DelayedStrategy(strategy,{delay:delay})}),"if":returnWithOriginalContext(function(_,test,trueBranch,falseBranch){return new Pusher.IfStrategy(test,trueBranch,falseBranch)}),is_supported:returnWithOriginalContext(function(_,strategy){return function(){return strategy.isSupported()}})};Pusher.StrategyBuilder=StrategyBuilder;var Protocol={};Protocol.decodeMessage=function(message){try{var params=JSON.parse(message.data);if("string"==typeof params.data)try{params.data=JSON.parse(params.data)}catch(e){if(!(e instanceof SyntaxError))throw e}return params}catch(e){throw{type:"MessageParseError",error:e,data:message.data}}},Protocol.encodeMessage=function(message){return JSON.stringify(message)},Protocol.processHandshake=function(message){if(message=this.decodeMessage(message),"pusher:connection_established"===message.event){if(!message.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:message.data.socket_id,activityTimeout:1e3*message.data.activity_timeout}}if("pusher:error"===message.event)return{action:this.getCloseAction(message.data),error:this.getCloseError(message.data)};throw"Invalid handshake"},Protocol.getCloseAction=function(closeEvent){return closeEvent.code<4e3?closeEvent.code>=1002&&closeEvent.code<=1004?"backoff":null:4e3===closeEvent.code?"ssl_only":closeEvent.code<4100?"refused":closeEvent.code<4200?"backoff":closeEvent.code<4300?"retry":"refused"},Protocol.getCloseError=function(closeEvent){return 1e3!==closeEvent.code&&1001!==closeEvent.code?{type:"PusherError",data:{code:closeEvent.code,message:closeEvent.reason||closeEvent.message}}:null},Pusher.Protocol=Protocol;var prototype=Connection.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},prototype.send=function(data){return this.transport.send(data)},prototype.send_event=function(name,data,channel){var message={event:name,data:data};return channel&&(message.channel=channel),Pusher.debug("Event sent",message),this.send(Pusher.Protocol.encodeMessage(message))},prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},prototype.close=function(){this.transport.close()},prototype.bindListeners=function(){var self=this,listeners={message:function(m){var message;try{message=Pusher.Protocol.decodeMessage(m)}catch(e){self.emit("error",{type:"MessageParseError",error:e,data:m.data})}if(void 0!==message){switch(Pusher.debug("Event recd",message),message.event){case"pusher:error":self.emit("error",{type:"PusherError",data:message.data});break;case"pusher:ping":self.emit("ping");break;case"pusher:pong":self.emit("pong")}self.emit("message",message)}},activity:function(){self.emit("activity")},error:function(error){self.emit("error",{type:"WebSocketError",error:error})},closed:function(closeEvent){unbindListeners(),closeEvent&&closeEvent.code&&self.handleCloseEvent(closeEvent),self.transport=null,self.emit("closed")}},unbindListeners=function(){Pusher.Util.objectApply(listeners,function(listener,event){self.transport.unbind(event,listener)})};Pusher.Util.objectApply(listeners,function(listener,event){self.transport.bind(event,listener)})},prototype.handleCloseEvent=function(closeEvent){var action=Pusher.Protocol.getCloseAction(closeEvent),error=Pusher.Protocol.getCloseError(closeEvent);error&&this.emit("error",error),action&&this.emit(action)},Pusher.Connection=Connection;var prototype=Handshake.prototype;prototype.close=function(){this.unbindListeners(),this.transport.close()},prototype.bindListeners=function(){var self=this;self.onMessage=function(m){self.unbindListeners();try{var result=Pusher.Protocol.processHandshake(m);"connected"===result.action?self.finish("connected",{connection:new Pusher.Connection(result.id,self.transport),activityTimeout:result.activityTimeout}):(self.finish(result.action,{error:result.error}),self.transport.close())}catch(e){self.finish("error",{error:e}),self.transport.close()}},self.onClosed=function(closeEvent){self.unbindListeners();var action=Pusher.Protocol.getCloseAction(closeEvent)||"backoff",error=Pusher.Protocol.getCloseError(closeEvent);self.finish(action,{error:error})},self.transport.bind("message",self.onMessage),self.transport.bind("closed",self.onClosed)},prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},prototype.finish=function(action,params){this.callback(Pusher.Util.extend({transport:this.transport,action:action},params))},Pusher.Handshake=Handshake;var prototype=ConnectionManager.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},prototype.send=function(data){return this.connection?this.connection.send(data):!1},prototype.send_event=function(name,data,channel){return this.connection?this.connection.send_event(name,data,channel):!1},prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},prototype.isEncrypted=function(){return this.encrypted},prototype.startConnecting=function(){var self=this,callback=function(error,handshake){error?self.runner=self.strategy.connect(0,callback):"error"===handshake.action?(self.emit("error",{type:"HandshakeError",error:handshake.error}),self.timeline.error({handshakeError:handshake.error})):(self.abortConnecting(),self.handshakeCallbacks[handshake.action](handshake))};self.runner=self.strategy.connect(0,callback)},prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},prototype.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var connection=this.abandonConnection();connection.close()}},prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},prototype.retryIn=function(delay){var self=this;self.timeline.info({action:"retry",delay:delay}),delay>0&&self.emit("connecting_in",Math.round(delay/1e3)),self.retryTimer=new Pusher.Timer(delay||0,function(){self.disconnectInternally(),self.connect()})},prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},prototype.setUnavailableTimer=function(){var self=this;self.unavailableTimer=new Pusher.Timer(self.options.unavailableTimeout,function(){self.updateState("unavailable"),self.disconnectInternally()})},prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},prototype.sendActivityCheck=function(){var self=this;self.stopActivityCheck(),self.connection.ping(),self.activityTimer=new Pusher.Timer(self.options.pongTimeout,function(){self.timeline.error({pong_timed_out:self.options.pongTimeout}),self.retryIn(0)})},prototype.resetActivityCheck=function(){var self=this;self.stopActivityCheck(),self.connection.handlesActivityChecks()||(self.activityTimer=new Pusher.Timer(self.activityTimeout,function(){self.sendActivityCheck()}))},prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},prototype.buildConnectionCallbacks=function(){var self=this;return{message:function(message){self.resetActivityCheck(),self.emit("message",message)},ping:function(){self.send_event("pusher:pong",{})},activity:function(){self.resetActivityCheck()},error:function(error){self.emit("error",{type:"WebSocketError",error:error})},closed:function(){self.abandonConnection(),self.shouldRetry()&&self.retryIn(1e3)}}},prototype.buildHandshakeCallbacks=function(errorCallbacks){var self=this;return Pusher.Util.extend({},errorCallbacks,{connected:function(handshake){self.activityTimeout=Math.min(self.options.activityTimeout,handshake.activityTimeout,handshake.connection.activityTimeout||1/0),self.clearUnavailableTimer(),self.setConnection(handshake.connection),self.socket_id=self.connection.id,self.updateState("connected",{socket_id:self.socket_id})}})},prototype.buildErrorCallbacks=function(){function withErrorEmitted(callback){return function(result){result.error&&self.emit("error",{type:"WebSocketError",error:result.error}),callback(result)}}var self=this;return{ssl_only:withErrorEmitted(function(){self.encrypted=!0,self.updateStrategy(),self.retryIn(0)}),refused:withErrorEmitted(function(){self.disconnect()}),backoff:withErrorEmitted(function(){self.retryIn(1e3)}),retry:withErrorEmitted(function(){self.retryIn(0)})}},prototype.setConnection=function(connection){this.connection=connection;for(var event in this.connectionCallbacks)this.connection.bind(event,this.connectionCallbacks[event]);this.resetActivityCheck()},prototype.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var event in this.connectionCallbacks)this.connection.unbind(event,this.connectionCallbacks[event]);var connection=this.connection;return this.connection=null,connection}},prototype.updateState=function(newState,data){var previousState=this.state;this.state=newState,previousState!==newState&&(Pusher.debug("State changed",previousState+" -> "+newState),this.timeline.info({state:newState,params:data}),this.emit("state_change",{previous:previousState,current:newState}),this.emit(newState,data))},prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},Pusher.ConnectionManager=ConnectionManager,Pusher.Util.extend(NetInfo.prototype,Pusher.EventsDispatcher.prototype);var prototype=NetInfo.prototype;prototype.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine},Pusher.NetInfo=NetInfo,Pusher.Network=new NetInfo;var prototype=Members.prototype;prototype.get=function(id){return Object.prototype.hasOwnProperty.call(this.members,id)?{id:id,info:this.members[id]}:null},prototype.each=function(callback){var self=this;Pusher.Util.objectApply(self.members,function(member,id){callback(self.get(id))})},prototype.setMyID=function(id){this.myID=id},prototype.onSubscription=function(subscriptionData){this.members=subscriptionData.presence.hash,this.count=subscriptionData.presence.count,this.me=this.get(this.myID)},prototype.addMember=function(memberData){return null===this.get(memberData.user_id)&&this.count++,this.members[memberData.user_id]=memberData.user_info,this.get(memberData.user_id)},prototype.removeMember=function(memberData){var member=this.get(memberData.user_id);return member&&(delete this.members[memberData.user_id],this.count--),member},prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},Pusher.Members=Members;var prototype=Channel.prototype;Pusher.Util.extend(prototype,Pusher.EventsDispatcher.prototype),prototype.authorize=function(socketId,callback){return callback(!1,{})},prototype.trigger=function(event,data){if(0!==event.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+event+"' does not start with 'client-'");return this.pusher.send_event(event,data,this.name)},prototype.disconnect=function(){this.subscribed=!1},prototype.handleEvent=function(event,data){0===event.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===event&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",data)):this.emit(event,data)},prototype.subscribe=function(){var self=this;self.authorize(self.pusher.connection.socket_id,function(error,data){error?self.handleEvent("pusher:subscription_error",data):self.pusher.send_event("pusher:subscribe",{auth:data.auth,channel_data:data.channel_data,channel:self.name})})},prototype.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},Pusher.Channel=Channel;var prototype=PrivateChannel.prototype;Pusher.Util.extend(prototype,Pusher.Channel.prototype),prototype.authorize=function(socketId,callback){var authorizer=new Pusher.Channel.Authorizer(this,this.pusher.config);return authorizer.authorize(socketId,callback)},Pusher.PrivateChannel=PrivateChannel;var prototype=PresenceChannel.prototype;Pusher.Util.extend(prototype,Pusher.PrivateChannel.prototype),prototype.authorize=function(socketId,callback){var _super=Pusher.PrivateChannel.prototype.authorize,self=this;_super.call(self,socketId,function(error,authData){if(!error){if(void 0===authData.channel_data)return Pusher.warn("Invalid auth response for channel '"+self.name+"', expected 'channel_data' field"),void callback("Invalid auth response");var channelData=JSON.parse(authData.channel_data);self.members.setMyID(channelData.user_id)}callback(error,authData)})},prototype.handleEvent=function(event,data){switch(event){case"pusher_internal:subscription_succeeded":this.members.onSubscription(data),this.subscribed=!0,this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var addedMember=this.members.addMember(data);this.emit("pusher:member_added",addedMember);break;case"pusher_internal:member_removed":var removedMember=this.members.removeMember(data);removedMember&&this.emit("pusher:member_removed",removedMember);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,event,data)}},prototype.disconnect=function(){this.members.reset(),Pusher.PrivateChannel.prototype.disconnect.call(this)},Pusher.PresenceChannel=PresenceChannel;var prototype=Channels.prototype;prototype.add=function(name,pusher){return this.channels[name]||(this.channels[name]=createChannel(name,pusher)),this.channels[name]},prototype.all=function(name){return Pusher.Util.values(this.channels)},prototype.find=function(name){return this.channels[name]},prototype.remove=function(name){var channel=this.channels[name];return delete this.channels[name],channel},prototype.disconnect=function(){Pusher.Util.objectApply(this.channels,function(channel){channel.disconnect()})},Pusher.Channels=Channels,Pusher.Channel.Authorizer=function(channel,options){this.channel=channel,this.type=options.authTransport,this.options=options,this.authOptions=(options||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(socketId){var query="socket_id="+encodeURIComponent(socketId)+"&channel_name="+encodeURIComponent(this.channel.name);for(var i in this.authOptions.params)query+="&"+encodeURIComponent(i)+"="+encodeURIComponent(this.authOptions.params[i]);return query},authorize:function(socketId,callback){return Pusher.authorizers[this.type].call(this,socketId,callback)}};var nextAuthCallbackID=1;Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(socketId,callback){var xhr,self=this;xhr=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xhr.open("POST",self.options.authEndpoint,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var headerName in this.authOptions.headers)xhr.setRequestHeader(headerName,this.authOptions.headers[headerName]);return xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status){var data,parsed=!1;try{data=JSON.parse(xhr.responseText),parsed=!0}catch(e){callback(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+xhr.responseText)}parsed&&callback(!1,data)}else Pusher.warn("Couldn't get auth info from your webapp",xhr.status),callback(!0,xhr.status)},xhr.send(this.composeQuery(socketId)),xhr},jsonp:function(socketId,callback){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var callbackName=nextAuthCallbackID.toString();nextAuthCallbackID++;var document=Pusher.Util.getDocument(),script=document.createElement("script");Pusher.auth_callbacks[callbackName]=function(data){callback(!1,data)};var callback_name="Pusher.auth_callbacks['"+callbackName+"']";script.src=this.options.authEndpoint+"?callback="+encodeURIComponent(callback_name)+"&"+this.composeQuery(socketId);var head=document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(script,head.firstChild)}},module.exports=Pusher},{}]},{},[1]);
